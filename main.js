!function(){"use strict";function e(e,t,r){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass)}function t(e,t,r){!function(e){return e.some(e=>!e.validity.valid)}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function r(r,n,{resetButtonState:o=!0}={}){const a=Array.from(r.querySelectorAll(n.inputSelector));a.forEach(t=>e(r,t,n)),o&&t(a,r.querySelector(n.submitButtonSelector),n)}const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_visible"},o=document.querySelector("#preview-modal"),a=document.querySelector("#edit-profile-modal"),i=document.querySelector("#new-post-modal"),l=document.querySelector("#delete-card-modal"),s=document.querySelector("#edit-avatar-modal"),c=document.querySelector("#edit-profile-form"),d=document.querySelector("#add-card-form"),u=document.querySelector("#delete-card-form"),m=document.querySelector("#edit-avatar-form"),v=c?.querySelector("button[type='submit']"),_=d?.querySelector("button[type='submit']"),y=u?.querySelector("button[type='submit']"),f=m?.querySelector("button[type='submit']"),p=document.querySelector(".profile__name"),S=document.querySelector(".profile__job"),b=document.querySelector(".profile__avatar"),q=document.querySelector(".profile__edit-btn"),h=document.querySelector(".profile__avatar-edit-btn"),k=a?.querySelector("#profile-name-input"),C=a?.querySelector("#profile-description-input"),L=document.querySelector(".cards__list"),E=document.querySelector("#card-template").content,g=o?.querySelector(".modal__preview-image"),A=o?.querySelector(".modal__caption"),x=new class{#e;#t;constructor({baseUrl:e,headers:t}){this.#e=e,this.#t=t}_request(e,t={}){const r=`${this.#e}${e}`,n={headers:this.#t,...t};return fetch(r,n).then(e=>e.ok?e.json():Promise.reject(`Error: ${e.status} ${e.statusText}`))}getUser(){return this._request("/users/me")}editUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar({avatar:e}){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}getInitialCards(){return this._request("/cards")}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}removeCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}unlikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}getAppData(){return Promise.all([this.getUser(),this.getInitialCards()])}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"95b0c08c-f2bc-4b3a-9d45-35928431d195","Content-Type":"application/json"}});function U(e,t,r,n){e&&(e.textContent=t?n:r,e.disabled=!!t)}function D(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",B)}function T(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",B)}function B(e){if("Escape"!==e.key)return;const t=document.querySelector(".modal.modal_is-opened");t&&T(t)}function $({name:e,about:t,avatar:r}){p.textContent=e,S.textContent=t,b.src=r}function w(e){const t=E.cloneNode(!0).querySelector(".card"),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),a=t.querySelector(".card__like-button"),i=t.querySelector(".card__like-count"),s=t.querySelector(".card__delete-button");return r.src=e.link,r.alt=e.name,n.textContent=e.name,i.textContent=e.likes?.length??0,r.addEventListener("click",()=>{o&&(A.textContent=e.name,g.src=e.link,g.alt=e.name,D(o))}),e.isLiked&&a.classList.add("card__like-button_active"),a.addEventListener("click",()=>function(e,{likeBtn:t,likeCount:r}){(t.classList.contains("card__like-button_active")?x.unlikeCard(e._id):x.likeCard(e._id)).then(n=>{t.classList.toggle("card__like-button_active",!!n.isLiked),r.textContent=n.likes?.length??(n.isLiked?1:0),e.isLiked=n.isLiked}).catch(e=>console.error("Toggle like failed:",e))}(e,{likeBtn:a,likeCount:i})),s.addEventListener("click",()=>function(e,t){P=e,j=t._id,D(l)}(t,e)),t}document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("mousedown",t=>{t.target===e&&T(e)}),e.querySelector(".modal__close-btn")?.addEventListener("click",()=>T(e))}),q?.addEventListener("click",()=>{D(a),k.value=p.textContent,C.value=S.textContent,r(c,n)}),c?.addEventListener("submit",e=>{e.preventDefault();const t=c.elements.name.value.trim(),r=c.elements.about.value.trim();U(v,!0,"Save","Saving…"),x.editUserInfo({name:t,about:r}).then(e=>{$(e),T(a)}).catch(e=>console.error("Edit profile failed:",e)).finally(()=>U(v,!1,"Save"))}),document.querySelector(".profile__new-post-btn")?.addEventListener("click",()=>{r(d,n),D(i)}),d?.addEventListener("submit",e=>{e.preventDefault();const t=d.elements.title.value.trim(),r=d.elements.link.value.trim();U(_,!0,"Create","Saving…"),x.addCard({name:t,link:r}).then(e=>{const t=w(e);L.prepend(t),d.reset(),T(i)}).catch(e=>console.error("Add card failed:",e)).finally(()=>U(_,!1,"Create"))}),h?.addEventListener("click",()=>{r(m,n),D(s)}),b?.addEventListener("click",()=>{r(m,n),D(s)}),m?.addEventListener("submit",e=>{e.preventDefault();const t=m.elements.avatar.value.trim();U(f,!0,"Save","Saving…"),x.updateAvatar({avatar:t}).then(e=>{$(e),m.reset(),T(s)}).catch(e=>console.error("Update avatar failed:",e)).finally(()=>U(f,!1,"Save"))});let P=null,j=null;var I;u?.addEventListener("submit",e=>{e.preventDefault(),j&&(U(y,!0,"Yes","Deleting…"),x.removeCard(j).then(()=>{P?.remove(),P=null,j=null,T(l)}).catch(e=>console.error("Delete card failed:",e)).finally(()=>U(y,!1,"Yes")))}),I=n,Array.from(document.querySelectorAll(I.formSelector)).forEach(r=>function(r,n){const o=Array.from(r.querySelectorAll(n.inputSelector)),a=r.querySelector(n.submitButtonSelector);t(o,a,n),o.forEach(i=>{i.addEventListener("input",()=>{!function(t,r,n){r.validity.valid?e(t,r,n):function(e,t,r,n){const o=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,r,r.validationMessage,n)}(r,i,n),t(o,a,n)})})}(r,I)),x.getAppData().then(([e,t])=>{$(e),function(e){L.innerHTML="",e.forEach(e=>{const t=w(e);L.prepend(t)})}(t)}).catch(e=>console.error("Failed to load app data:",e))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QUFNVSxNQUNaNUMsRUFBV2tDLEdBL0hqQixTQUFxQlUsR0FDbkJ0RyxFQUFldUcsVUFBWSxHQUMzQkQsRUFBTS9ILFFBQVNzRixJQUNiLE1BQU1pQyxFQUFLbEMsRUFBa0JDLEdBQzdCN0QsRUFBZStGLFFBQVFELElBRTNCLENBMEhNVSxDQUFZRixLQUViekIsTUFBT0MsR0FBUUMsUUFBUUMsTUFBTSwyQkFBNEJGLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBtZXNzYWdlLCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICBlcnJvckVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGVycm9yRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpIHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZykge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihjb25maWcpIHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldFZhbGlkYXRpb24oXG4gIGZvcm1FbCxcbiAgY29uZmlnLFxuICB7IHJlc2V0QnV0dG9uU3RhdGUgPSB0cnVlIH0gPSB7fVxuKSB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSk7XG5cbiAgaWYgKHJlc2V0QnV0dG9uU3RhdGUpIHtcbiAgICBjb25zdCBidXR0b25FbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl92aXNpYmxlXCIsXG59O1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgZW5hYmxlVmFsaWRhdGlvbiwgcmVzZXRWYWxpZGF0aW9uIH0gZnJvbSBcIi4uL3NjcmlwdHMvdmFsaWRhdGlvbi5qc1wiO1xuaW1wb3J0IHsgdmFsaWRhdGlvbkNvbmZpZyB9IGZyb20gXCIuLi9zY3JpcHRzL2NvbnN0YW50cy5qc1wiO1xuXG5jb25zdCBwcmV2aWV3TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI3ByZXZpZXctbW9kYWxcIik7XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBhZGRDYXJkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgZGVsZXRlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2RlbGV0ZS1jYXJkLW1vZGFsXCIpO1xuY29uc3QgZWRpdEF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcblxuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtZm9ybVwiKTtcbmNvbnN0IGFkZENhcmRGb3JtID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNhZGQtY2FyZC1mb3JtXCIpO1xuY29uc3QgZGVsZXRlRm9ybSA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWNhcmQtZm9ybVwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtYXZhdGFyLWZvcm1cIik7XG5cbmNvbnN0IHByb2ZpbGVTdWJtaXRCdG4gPSBlZGl0UHJvZmlsZUZvcm0/LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiYnV0dG9uW3R5cGU9J3N1Ym1pdCddXCJcbik7XG5jb25zdCBhZGRDYXJkU3VibWl0QnRuID0gYWRkQ2FyZEZvcm0/LnF1ZXJ5U2VsZWN0b3IoXCJidXR0b25bdHlwZT0nc3VibWl0J11cIik7XG5jb25zdCBkZWxldGVTdWJtaXRCdG4gPSBkZWxldGVGb3JtPy5xdWVyeVNlbGVjdG9yKFwiYnV0dG9uW3R5cGU9J3N1Ym1pdCddXCIpO1xuY29uc3QgYXZhdGFyU3VibWl0QnRuID0gYXZhdGFyRm9ybT8ucXVlcnlTZWxlY3RvcihcImJ1dHRvblt0eXBlPSdzdWJtaXQnXVwiKTtcblxuY29uc3QgbmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgYWJvdXRFbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fam9iXCIpO1xuY29uc3QgYXZhdGFyRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGF2YXRhckVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1lZGl0LWJ0blwiKTtcblxuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcblxuY29uc3QgY2FyZHNDb250YWluZXIgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuY29uc3QgY2FyZFRlbXBsYXRlID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpLmNvbnRlbnQ7XG5cbmNvbnN0IG1vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3ByZXZpZXctaW1hZ2VcIik7XG5jb25zdCBtb2RhbENhcHRpb24gPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjk1YjBjMDhjLWYyYmMtNGIzYS05ZDQ1LTM1OTI4NDMxZDE5NVwiLFxuICAgIFwiQ29udGVudC1UeXBlXCI6IFwiYXBwbGljYXRpb24vanNvblwiLFxuICB9LFxufSk7XG5cbmZ1bmN0aW9uIHJlbmRlckxvYWRpbmcoYnV0dG9uLCBpc0xvYWRpbmcsIGlkbGVUZXh0LCBsb2FkaW5nVGV4dCkge1xuICBpZiAoIWJ1dHRvbikgcmV0dXJuO1xuICBidXR0b24udGV4dENvbnRlbnQgPSBpc0xvYWRpbmcgPyBsb2FkaW5nVGV4dCA6IGlkbGVUZXh0O1xuICBidXR0b24uZGlzYWJsZWQgPSAhIWlzTG9hZGluZztcbn1cblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbn1cbmZ1bmN0aW9uIGNsb3NlTW9kYWwobW9kYWwpIHtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjQ2xvc2UpO1xufVxuZnVuY3Rpb24gaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gIGlmIChldnQua2V5ICE9PSBcIkVzY2FwZVwiKSByZXR1cm47XG4gIGNvbnN0IG9wZW5lZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwubW9kYWxfaXMtb3BlbmVkXCIpO1xuICBpZiAob3BlbmVkKSBjbG9zZU1vZGFsKG9wZW5lZCk7XG59XG5cbmRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoXCIubW9kYWxcIikuZm9yRWFjaCgobW9kYWwpID0+IHtcbiAgbW9kYWwuYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICAgIGlmIChlLnRhcmdldCA9PT0gbW9kYWwpIGNsb3NlTW9kYWwobW9kYWwpO1xuICB9KTtcbiAgbW9kYWxcbiAgICAucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpXG4gICAgPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChtb2RhbCkpO1xufSk7XG5cbmZ1bmN0aW9uIHJlbmRlclVzZXIoeyBuYW1lLCBhYm91dCwgYXZhdGFyIH0pIHtcbiAgbmFtZUVsLnRleHRDb250ZW50ID0gbmFtZTtcbiAgYWJvdXRFbC50ZXh0Q29udGVudCA9IGFib3V0O1xuICBhdmF0YXJFbC5zcmMgPSBhdmF0YXI7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZUNhcmRFbGVtZW50KGNhcmQpIHtcbiAgY29uc3QgY2FyZEVsID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKS5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIik7XG5cbiAgY29uc3QgaW1nID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IHRpdGxlID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fdGl0bGVcIik7XG4gIGNvbnN0IGxpa2VCdG4gPSBjYXJkRWwucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWJ1dHRvblwiKTtcbiAgY29uc3QgbGlrZUNvdW50ID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1jb3VudFwiKTtcbiAgY29uc3QgZGVsZXRlQnRuID0gY2FyZEVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ1dHRvblwiKTtcblxuICBpbWcuc3JjID0gY2FyZC5saW5rO1xuICBpbWcuYWx0ID0gY2FyZC5uYW1lO1xuICB0aXRsZS50ZXh0Q29udGVudCA9IGNhcmQubmFtZTtcbiAgbGlrZUNvdW50LnRleHRDb250ZW50ID0gY2FyZC5saWtlcz8ubGVuZ3RoID8/IDA7XG5cbiAgaW1nLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgaWYgKCFwcmV2aWV3TW9kYWwpIHJldHVybjtcbiAgICBtb2RhbENhcHRpb24udGV4dENvbnRlbnQgPSBjYXJkLm5hbWU7XG4gICAgbW9kYWxJbWFnZS5zcmMgPSBjYXJkLmxpbms7XG4gICAgbW9kYWxJbWFnZS5hbHQgPSBjYXJkLm5hbWU7XG4gICAgb3Blbk1vZGFsKHByZXZpZXdNb2RhbCk7XG4gIH0pO1xuXG4gIGlmIChjYXJkLmlzTGlrZWQpIGxpa2VCdG4uY2xhc3NMaXN0LmFkZChcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcblxuICBsaWtlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICAgIGhhbmRsZVRvZ2dsZUxpa2UoY2FyZCwgeyBsaWtlQnRuLCBsaWtlQ291bnQgfSlcbiAgKTtcbiAgZGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBoYW5kbGVEZWxldGVDbGljayhjYXJkRWwsIGNhcmQpKTtcblxuICByZXR1cm4gY2FyZEVsO1xufVxuXG5mdW5jdGlvbiByZW5kZXJDYXJkcyhjYXJkcykge1xuICBjYXJkc0NvbnRhaW5lci5pbm5lckhUTUwgPSBcIlwiO1xuICBjYXJkcy5mb3JFYWNoKChjYXJkKSA9PiB7XG4gICAgY29uc3QgZWwgPSBjcmVhdGVDYXJkRWxlbWVudChjYXJkKTtcbiAgICBjYXJkc0NvbnRhaW5lci5wcmVwZW5kKGVsKTtcbiAgfSk7XG59XG5cbmVkaXRQcm9maWxlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gbmFtZUVsLnRleHRDb250ZW50O1xuICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBhYm91dEVsLnRleHRDb250ZW50O1xuICByZXNldFZhbGlkYXRpb24oZWRpdFByb2ZpbGVGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcbn0pO1xuXG5lZGl0UHJvZmlsZUZvcm0/LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBuYW1lID0gZWRpdFByb2ZpbGVGb3JtLmVsZW1lbnRzLm5hbWUudmFsdWUudHJpbSgpO1xuICBjb25zdCBhYm91dCA9IGVkaXRQcm9maWxlRm9ybS5lbGVtZW50cy5hYm91dC52YWx1ZS50cmltKCk7XG5cbiAgcmVuZGVyTG9hZGluZyhwcm9maWxlU3VibWl0QnRuLCB0cnVlLCBcIlNhdmVcIiwgXCJTYXZpbmfigKZcIik7XG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KVxuICAgIC50aGVuKCh1c2VyKSA9PiB7XG4gICAgICByZW5kZXJVc2VyKHVzZXIpO1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaCgoZXJyKSA9PiBjb25zb2xlLmVycm9yKFwiRWRpdCBwcm9maWxlIGZhaWxlZDpcIiwgZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiByZW5kZXJMb2FkaW5nKHByb2ZpbGVTdWJtaXRCdG4sIGZhbHNlLCBcIlNhdmVcIikpO1xufSk7XG5cbmRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25ldy1wb3N0LWJ0blwiKVxuICA/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgcmVzZXRWYWxpZGF0aW9uKGFkZENhcmRGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICBvcGVuTW9kYWwoYWRkQ2FyZE1vZGFsKTtcbiAgfSk7XG5cbmFkZENhcmRGb3JtPy5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChlKSA9PiB7XG4gIGUucHJldmVudERlZmF1bHQoKTtcbiAgY29uc3QgbmFtZSA9IGFkZENhcmRGb3JtLmVsZW1lbnRzLnRpdGxlLnZhbHVlLnRyaW0oKTtcbiAgY29uc3QgbGluayA9IGFkZENhcmRGb3JtLmVsZW1lbnRzLmxpbmsudmFsdWUudHJpbSgpO1xuXG4gIHJlbmRlckxvYWRpbmcoYWRkQ2FyZFN1Ym1pdEJ0biwgdHJ1ZSwgXCJDcmVhdGVcIiwgXCJTYXZpbmfigKZcIik7XG4gIGFwaVxuICAgIC5hZGRDYXJkKHsgbmFtZSwgbGluayB9KVxuICAgIC50aGVuKChjYXJkKSA9PiB7XG4gICAgICBjb25zdCBlbCA9IGNyZWF0ZUNhcmRFbGVtZW50KGNhcmQpO1xuICAgICAgY2FyZHNDb250YWluZXIucHJlcGVuZChlbCk7XG4gICAgICBhZGRDYXJkRm9ybS5yZXNldCgpO1xuICAgICAgY2xvc2VNb2RhbChhZGRDYXJkTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJBZGQgY2FyZCBmYWlsZWQ6XCIsIGVycikpXG4gICAgLmZpbmFsbHkoKCkgPT4gcmVuZGVyTG9hZGluZyhhZGRDYXJkU3VibWl0QnRuLCBmYWxzZSwgXCJDcmVhdGVcIikpO1xufSk7XG5cbmF2YXRhckVkaXRCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIHJlc2V0VmFsaWRhdGlvbihhdmF0YXJGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgb3Blbk1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG59KTtcbmF2YXRhckVsPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XG4gIG9wZW5Nb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xufSk7XG5cbmF2YXRhckZvcm0/LmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgKGUpID0+IHtcbiAgZS5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBhdmF0YXIgPSBhdmF0YXJGb3JtLmVsZW1lbnRzLmF2YXRhci52YWx1ZS50cmltKCk7XG5cbiAgcmVuZGVyTG9hZGluZyhhdmF0YXJTdWJtaXRCdG4sIHRydWUsIFwiU2F2ZVwiLCBcIlNhdmluZ+KAplwiKTtcbiAgYXBpXG4gICAgLnVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KVxuICAgIC50aGVuKCh1c2VyKSA9PiB7XG4gICAgICByZW5kZXJVc2VyKHVzZXIpO1xuICAgICAgYXZhdGFyRm9ybS5yZXNldCgpO1xuICAgICAgY2xvc2VNb2RhbChlZGl0QXZhdGFyTW9kYWwpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJVcGRhdGUgYXZhdGFyIGZhaWxlZDpcIiwgZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiByZW5kZXJMb2FkaW5nKGF2YXRhclN1Ym1pdEJ0biwgZmFsc2UsIFwiU2F2ZVwiKSk7XG59KTtcblxubGV0IHNlbGVjdGVkQ2FyZEVsID0gbnVsbDtcbmxldCBzZWxlY3RlZENhcmRJZCA9IG51bGw7XG5cbmZ1bmN0aW9uIGhhbmRsZURlbGV0ZUNsaWNrKGNhcmRFbCwgZGF0YSkge1xuICBzZWxlY3RlZENhcmRFbCA9IGNhcmRFbDtcbiAgc2VsZWN0ZWRDYXJkSWQgPSBkYXRhLl9pZDtcbiAgb3Blbk1vZGFsKGRlbGV0ZU1vZGFsKTtcbn1cblxuZGVsZXRlRm9ybT8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGlmICghc2VsZWN0ZWRDYXJkSWQpIHJldHVybjtcblxuICByZW5kZXJMb2FkaW5nKGRlbGV0ZVN1Ym1pdEJ0biwgdHJ1ZSwgXCJZZXNcIiwgXCJEZWxldGluZ+KAplwiKTtcbiAgYXBpXG4gICAgLnJlbW92ZUNhcmQoc2VsZWN0ZWRDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgc2VsZWN0ZWRDYXJkRWw/LnJlbW92ZSgpO1xuICAgICAgc2VsZWN0ZWRDYXJkRWwgPSBudWxsO1xuICAgICAgc2VsZWN0ZWRDYXJkSWQgPSBudWxsO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIkRlbGV0ZSBjYXJkIGZhaWxlZDpcIiwgZXJyKSlcbiAgICAuZmluYWxseSgoKSA9PiByZW5kZXJMb2FkaW5nKGRlbGV0ZVN1Ym1pdEJ0biwgZmFsc2UsIFwiWWVzXCIpKTtcbn0pO1xuXG5mdW5jdGlvbiBoYW5kbGVUb2dnbGVMaWtlKGNhcmQsIHsgbGlrZUJ0biwgbGlrZUNvdW50IH0pIHtcbiAgY29uc3QgaXNBY3RpdmUgPSBsaWtlQnRuLmNsYXNzTGlzdC5jb250YWlucyhcImNhcmRfX2xpa2UtYnV0dG9uX2FjdGl2ZVwiKTtcbiAgY29uc3QgcmVxID0gaXNBY3RpdmUgPyBhcGkudW5saWtlQ2FyZChjYXJkLl9pZCkgOiBhcGkubGlrZUNhcmQoY2FyZC5faWQpO1xuXG4gIHJlcVxuICAgIC50aGVuKCh1cGRhdGVkKSA9PiB7XG4gICAgICBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ1dHRvbl9hY3RpdmVcIiwgISF1cGRhdGVkLmlzTGlrZWQpO1xuICAgICAgbGlrZUNvdW50LnRleHRDb250ZW50ID1cbiAgICAgICAgdXBkYXRlZC5saWtlcz8ubGVuZ3RoID8/ICh1cGRhdGVkLmlzTGlrZWQgPyAxIDogMCk7XG4gICAgICBjYXJkLmlzTGlrZWQgPSB1cGRhdGVkLmlzTGlrZWQ7XG4gICAgfSlcbiAgICAuY2F0Y2goKGVycikgPT4gY29uc29sZS5lcnJvcihcIlRvZ2dsZSBsaWtlIGZhaWxlZDpcIiwgZXJyKSk7XG59XG5cbmZ1bmN0aW9uIGluaXQoKSB7XG4gIGVuYWJsZVZhbGlkYXRpb24odmFsaWRhdGlvbkNvbmZpZyk7XG5cbiAgYXBpXG4gICAgLmdldEFwcERhdGEoKVxuICAgIC50aGVuKChbdXNlciwgY2FyZHNdKSA9PiB7XG4gICAgICByZW5kZXJVc2VyKHVzZXIpO1xuICAgICAgcmVuZGVyQ2FyZHMoY2FyZHMpO1xuICAgIH0pXG4gICAgLmNhdGNoKChlcnIpID0+IGNvbnNvbGUuZXJyb3IoXCJGYWlsZWQgdG8gbG9hZCBhcHAgZGF0YTpcIiwgZXJyKSk7XG59XG5cbmluaXQoKTtcbiIsImV4cG9ydCBkZWZhdWx0IGNsYXNzIEFwaSB7XG4gICNiYXNlVXJsO1xuICAjaGVhZGVycztcblxuICBjb25zdHJ1Y3Rvcih7IGJhc2VVcmwsIGhlYWRlcnMgfSkge1xuICAgIHRoaXMuI2Jhc2VVcmwgPSBiYXNlVXJsO1xuICAgIHRoaXMuI2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgX3JlcXVlc3QocGF0aCwgb3B0aW9ucyA9IHt9KSB7XG4gICAgY29uc3QgdXJsID0gYCR7dGhpcy4jYmFzZVVybH0ke3BhdGh9YDtcbiAgICBjb25zdCBvcHRzID0ge1xuICAgICAgaGVhZGVyczogdGhpcy4jaGVhZGVycyxcbiAgICAgIC4uLm9wdGlvbnMsXG4gICAgfTtcbiAgICByZXR1cm4gZmV0Y2godXJsLCBvcHRzKS50aGVuKChyZXMpID0+IHtcbiAgICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xuICAgICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfSAke3Jlcy5zdGF0dXNUZXh0fWApO1xuICAgIH0pO1xuICB9XG5cbiAgZ2V0VXNlcigpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL3VzZXJzL21lYCk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUF2YXRhcih7IGF2YXRhciB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgYXZhdGFyIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHNgKTtcbiAgfVxuXG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIHJlbW92ZUNhcmQoY2FyZElkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy8ke2NhcmRJZH1gLCB7IG1ldGhvZDogXCJERUxFVEVcIiB9KTtcbiAgfVxuXG4gIGxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwgeyBtZXRob2Q6IFwiUFVUXCIgfSk7XG4gIH1cblxuICB1bmxpa2VDYXJkKGNhcmRJZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtjYXJkSWR9L2xpa2VzYCwgeyBtZXRob2Q6IFwiREVMRVRFXCIgfSk7XG4gIH1cblxuICBnZXRBcHBEYXRhKCkge1xuICAgIHJldHVybiBQcm9taXNlLmFsbChbdGhpcy5nZXRVc2VyKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcbiAgfVxufVxuIl0sIm5hbWVzIjpbImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJyZXNldEJ1dHRvblN0YXRlIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJmb3JFYWNoIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwicHJldmlld01vZGFsIiwiZG9jdW1lbnQiLCJlZGl0UHJvZmlsZU1vZGFsIiwiYWRkQ2FyZE1vZGFsIiwiZGVsZXRlTW9kYWwiLCJlZGl0QXZhdGFyTW9kYWwiLCJlZGl0UHJvZmlsZUZvcm0iLCJhZGRDYXJkRm9ybSIsImRlbGV0ZUZvcm0iLCJhdmF0YXJGb3JtIiwicHJvZmlsZVN1Ym1pdEJ0biIsImFkZENhcmRTdWJtaXRCdG4iLCJkZWxldGVTdWJtaXRCdG4iLCJhdmF0YXJTdWJtaXRCdG4iLCJuYW1lRWwiLCJhYm91dEVsIiwiYXZhdGFyRWwiLCJlZGl0UHJvZmlsZUJ0biIsImF2YXRhckVkaXRCdG4iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsImNhcmRzQ29udGFpbmVyIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsIm1vZGFsSW1hZ2UiLCJtb2RhbENhcHRpb24iLCJhcGkiLCJjb25zdHJ1Y3RvciIsImJhc2VVcmwiLCJoZWFkZXJzIiwidGhpcyIsIl9yZXF1ZXN0IiwicGF0aCIsIm9wdGlvbnMiLCJ1cmwiLCJvcHRzIiwiZmV0Y2giLCJ0aGVuIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsInN0YXR1c1RleHQiLCJnZXRVc2VyIiwiZWRpdFVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwibWV0aG9kIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1cGRhdGVBdmF0YXIiLCJhdmF0YXIiLCJnZXRJbml0aWFsQ2FyZHMiLCJhZGRDYXJkIiwibGluayIsInJlbW92ZUNhcmQiLCJjYXJkSWQiLCJsaWtlQ2FyZCIsInVubGlrZUNhcmQiLCJnZXRBcHBEYXRhIiwiYWxsIiwiYXV0aG9yaXphdGlvbiIsInJlbmRlckxvYWRpbmciLCJidXR0b24iLCJpc0xvYWRpbmciLCJpZGxlVGV4dCIsImxvYWRpbmdUZXh0Iiwib3Blbk1vZGFsIiwibW9kYWwiLCJhZGRFdmVudExpc3RlbmVyIiwiaGFuZGxlRXNjQ2xvc2UiLCJjbG9zZU1vZGFsIiwicmVtb3ZlRXZlbnRMaXN0ZW5lciIsImV2dCIsImtleSIsIm9wZW5lZCIsInJlbmRlclVzZXIiLCJzcmMiLCJjcmVhdGVDYXJkRWxlbWVudCIsImNhcmQiLCJjYXJkRWwiLCJjbG9uZU5vZGUiLCJpbWciLCJ0aXRsZSIsImxpa2VCdG4iLCJsaWtlQ291bnQiLCJkZWxldGVCdG4iLCJhbHQiLCJsaWtlcyIsImxlbmd0aCIsImlzTGlrZWQiLCJjb250YWlucyIsIl9pZCIsInVwZGF0ZWQiLCJ0b2dnbGUiLCJjYXRjaCIsImVyciIsImNvbnNvbGUiLCJlcnJvciIsImhhbmRsZVRvZ2dsZUxpa2UiLCJkYXRhIiwic2VsZWN0ZWRDYXJkRWwiLCJzZWxlY3RlZENhcmRJZCIsImhhbmRsZURlbGV0ZUNsaWNrIiwiZSIsInRhcmdldCIsInZhbHVlIiwicHJldmVudERlZmF1bHQiLCJlbGVtZW50cyIsInRyaW0iLCJ1c2VyIiwiZmluYWxseSIsImVsIiwicHJlcGVuZCIsInJlc2V0IiwibWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzZXRFdmVudExpc3RlbmVycyIsImNhcmRzIiwiaW5uZXJIVE1MIiwicmVuZGVyQ2FyZHMiXSwic291cmNlUm9vdCI6IiJ9