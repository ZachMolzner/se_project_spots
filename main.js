!function(){"use strict";function e(e,t,r){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass)}function t(e,t,r){!function(e){return e.some(e=>!e.validity.valid)}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function r(r,n,{resetButtonState:o=!0}={}){const a=Array.from(r.querySelectorAll(n.inputSelector));a.forEach(t=>e(r,t,n)),o&&t(a,r.querySelector(n.submitButtonSelector),n)}const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_visible"},o=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e.replace(/\/$/,""),this._headers=t}_handleResponse(e){return e.ok?e.json():e.text().then(t=>{const r=t&&t.trim().length?t:`HTTP ${e.status}`;throw new Error(r)})}_request(e,{method:t="GET",headers:r,body:n}={}){const o={...this._headers,...n?{"Content-Type":"application/json"}:{},...r||{}};return fetch(`${this._baseUrl}${e}`,{method:t,headers:o,body:n}).then(e=>this._handleResponse(e))}getUserInfo(){return this._request("/users/me")}updateUserInfo({name:e,about:t}){return this._request("/users/me",{method:"PATCH",body:JSON.stringify({name:e,about:t})})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}getInitialCards(){return this._request("/cards")}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/likes/${e}`,{method:"PUT"})}unlikeCard(e){return this._request(`/cards/likes/${e}`,{method:"DELETE"})}changeLikeCardStatus(e,t){return t?this.likeCard(e):this.unlikeCard(e)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"24f933de-7581-4b4c-ade4-c1a359c82b1b"}});let a=null;function s(e){e&&(e.classList.add("modal_is-opened"),document.addEventListener("keydown",l))}function i(e){e&&(e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",l))}function l(e){if("Escape"===e.key){const e=document.querySelector(".modal.modal_is-opened");e&&i(e)}}function c(e,t){e&&(e.dataset.defaultText??=e.textContent,e.textContent=t?"Savingâ€¦":e.dataset.defaultText,e.disabled=!!t)}const d=document.querySelector("#preview-modal"),u=d?.querySelector(".modal__preview-image"),m=d?.querySelector(".modal__caption"),_=d?.querySelector(".modal__close-btn_type_preview"),y=document.querySelector(".profile__edit-btn"),v=document.querySelector("#edit-profile-modal"),p=v?.querySelector(".modal__close-btn"),S=v?.querySelector(".modal__form"),b=v?.querySelector("#profile-name-input"),f=v?.querySelector("#profile-description-input"),h=document.querySelector(".profile__name"),q=document.querySelector(".profile__description"),E=document.querySelector(".profile__new-post-btn"),k=document.querySelector("#new-post-modal"),C=k?.querySelector(".modal__close-btn"),L=k?.querySelector(".modal__form"),g=k?.querySelector("#card-image-input"),w=k?.querySelector("#card-caption-input"),x=document.querySelector(".profile__avatar"),T=document.querySelector(".profile__avatar-edit-btn"),A=document.querySelector("#edit-avatar-modal"),U=A?.querySelector(".modal__form"),$=A?.querySelector("#avatar-link-input"),B=A?.querySelector(".modal__close-btn"),D=document.querySelector("#confirm-modal"),I=D?.querySelector(".modal__form"),P=D?.querySelector(".modal__close-btn"),H=document.querySelector("#card-template")?.content.querySelector(".card"),N=document.querySelector(".cards__list");function O(e){const t=H.cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),l=t.querySelector(".card__like-btn"),_=t.querySelector(".card__delete-btn"),y=t.querySelector(".card__like-count");r.src=e.link,r.alt=e.name,n.textContent=e.name;const v=Array.isArray(e.likes)?e.likes:[],p=v.some(e=>e._id===a);return l.classList.toggle("card__like-btn_active",p),y&&(y.textContent=String(v.length)),e.owner&&e.owner._id===a||_?.remove(),r.addEventListener("click",()=>{d&&(m.textContent=e.name,u.src=e.link,u.alt=e.name,s(d))}),l.addEventListener("click",()=>{const t=l.classList.contains("card__like-btn_active");l.disabled=!0,(t?o.unlikeCard(e._id):o.likeCard(e._id)).then(e=>{const t=e.likes.some(e=>e._id===a);l.classList.toggle("card__like-btn_active",t),y&&(y.textContent=String(e.likes.length))}).catch(console.error).finally(()=>l.disabled=!1)}),_?.addEventListener("click",()=>{const r=()=>{const r=D?.querySelector('button[type="submit"]');c(r,!0),o.deleteCard(e._id).then(()=>{t.remove(),D&&i(D)}).catch(console.error).finally(()=>c(r,!1))};if(D&&I){s(D);const e=t=>{t.preventDefault(),I.removeEventListener("submit",e),r()};I.addEventListener("submit",e,{once:!0})}else window.confirm("Delete this card?")&&r()}),t}var J;_?.addEventListener("click",()=>i(d)),d?.addEventListener("mousedown",e=>{e.target===d&&i(d)}),y?.addEventListener("click",()=>{s(v),b&&(b.value=h.textContent),f&&(f.value=q.textContent),S&&r(S,n)}),p?.addEventListener("click",()=>i(v)),v?.addEventListener("mousedown",e=>{e.target===v&&i(v)}),E?.addEventListener("click",()=>s(k)),C?.addEventListener("click",()=>i(k)),k?.addEventListener("mousedown",e=>{e.target===k&&i(k)}),T?.addEventListener("click",()=>{A&&(s(A),U&&r(U,n))}),B?.addEventListener("click",()=>i(A)),A?.addEventListener("mousedown",e=>{e.target===A&&i(A)}),P?.addEventListener("click",()=>i(D)),D?.addEventListener("mousedown",e=>{e.target===D&&i(D)}),S?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||S.querySelector('button[type="submit"]');c(t,!0);const r=b.value.trim(),n=f.value.trim();o.updateUserInfo({name:r,about:n}).then(e=>{h.textContent=e.name,q.textContent=e.about,i(v)}).catch(console.error).finally(()=>c(t,!1))}),L?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||L.querySelector('button[type="submit"]');c(t,!0);const a=w.value.trim(),s=g.value.trim();o.addCard({name:a,link:s}).then(e=>{N.prepend(O(e)),i(k),L.reset(),r(L,n)}).catch(console.error).finally(()=>c(t,!1))}),U?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||U.querySelector('button[type="submit"]');c(t,!0);const a=$.value.trim();o.updateAvatar(a).then(e=>{x&&(x.src=e.avatar),i(A),U.reset(),r(U,n)}).catch(console.error).finally(()=>c(t,!1))}),Promise.all([o.getUserInfo(),o.getInitialCards()]).then(([e,t])=>{a=e._id,h&&(h.textContent=e.name),q&&(q.textContent=e.about),x&&(x.src=e.avatar),N.innerHTML="",t.forEach(e=>N.append(O(e)))}).catch(console.error),J=n,Array.from(document.querySelectorAll(J.formSelector)).forEach(r=>function(r,n){const o=Array.from(r.querySelectorAll(n.inputSelector)),a=r.querySelector(n.submitButtonSelector);t(o,a,n),o.forEach(s=>{s.addEventListener("input",()=>{!function(t,r,n){r.validity.valid?e(t,r,n):function(e,t,r,n){const o=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,r,r.validationMessage,n)}(r,s,n),t(o,a,n)})})}(r,J))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QkFDN0JMLEVBQVFNLFlBQWNnSyxFQUN0QnRLLEVBQVFHLFVBQVVjLElBQUlsQixFQUFPUSxXQUMvQixDQVdJZ0ssQ0FBZTFLLEVBQVFDLEVBQVNBLEVBQVEwSyxrQkFBbUJ6SyxFQUkvRCxDQXdCTTBLLENBQW1CNUssRUFBUUMsRUFBU0MsR0FDcENTLEVBQWtCQyxFQUFXQyxFQUFVWCxNQUc3QyxDQUkrQjJLLENBQWtCN0ssRUFBUUUsRyIsInNvdXJjZXMiOlsid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy92YWxpZGF0aW9uLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvc2NyaXB0cy9jb25zdGFudHMuanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9wYWdlcy9pbmRleC5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3V0aWxzL0FwaS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJmdW5jdGlvbiBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIG1lc3NhZ2UsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGlucHV0RWwuY2xhc3NMaXN0LmFkZChjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbC50ZXh0Q29udGVudCA9IG1lc3NhZ2U7XG4gIGVycm9yRWwuY2xhc3NMaXN0LmFkZChjb25maWcuZXJyb3JDbGFzcyk7XG59XG5cbmZ1bmN0aW9uIGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSB7XG4gIGNvbnN0IGVycm9yRWwgPSBmb3JtRWwucXVlcnlTZWxlY3RvcihgIyR7aW5wdXRFbC5pZH0tZXJyb3JgKTtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xuICBlcnJvckVsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgZXJyb3JFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5lcnJvckNsYXNzKTtcbn1cblxuZnVuY3Rpb24gY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn1cblxuZnVuY3Rpb24gaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkge1xuICByZXR1cm4gaW5wdXRMaXN0LnNvbWUoKGlucHV0RWwpID0+ICFpbnB1dEVsLnZhbGlkaXR5LnZhbGlkKTtcbn1cblxuZnVuY3Rpb24gdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0KSkge1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICAgIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICB9XG59XG5cbmZ1bmN0aW9uIHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKSB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG4gIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG5cbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IHtcbiAgICBpbnB1dEVsLmFkZEV2ZW50TGlzdGVuZXIoXCJpbnB1dFwiLCAoKSA9PiB7XG4gICAgICBjaGVja0lucHV0VmFsaWRpdHkoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICAgICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgICB9KTtcbiAgfSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiBlbmFibGVWYWxpZGF0aW9uKGNvbmZpZykge1xuICBjb25zdCBmb3JtTGlzdCA9IEFycmF5LmZyb20oZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChjb25maWcuZm9ybVNlbGVjdG9yKSk7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4gc2V0RXZlbnRMaXN0ZW5lcnMoZm9ybUVsLCBjb25maWcpKTtcbn1cblxuZXhwb3J0IGZ1bmN0aW9uIHJlc2V0VmFsaWRhdGlvbihcbiAgZm9ybUVsLFxuICBjb25maWcsXG4gIHsgcmVzZXRCdXR0b25TdGF0ZSA9IHRydWUgfSA9IHt9XG4pIHtcbiAgY29uc3QgaW5wdXRMaXN0ID0gQXJyYXkuZnJvbShmb3JtRWwucXVlcnlTZWxlY3RvckFsbChjb25maWcuaW5wdXRTZWxlY3RvcikpO1xuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4gaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpKTtcblxuICBpZiAocmVzZXRCdXR0b25TdGF0ZSkge1xuICAgIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcbiAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuICB9XG59XG4iLCJleHBvcnQgY29uc3QgdmFsaWRhdGlvbkNvbmZpZyA9IHtcbiAgZm9ybVNlbGVjdG9yOiBcIi5tb2RhbF9fZm9ybVwiLFxuICBpbnB1dFNlbGVjdG9yOiBcIi5tb2RhbF9faW5wdXRcIixcbiAgc3VibWl0QnV0dG9uU2VsZWN0b3I6IFwiLm1vZGFsX19zdWJtaXQtYnRuXCIsXG4gIGluYWN0aXZlQnV0dG9uQ2xhc3M6IFwibW9kYWxfX3N1Ym1pdC1idG5fZGlzYWJsZWRcIixcbiAgaW5wdXRFcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dF90eXBlX2Vycm9yXCIsXG4gIGVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0LWVycm9yX3Zpc2libGVcIixcbn07XG4iLCJpbXBvcnQgXCIuL2luZGV4LmNzc1wiO1xuaW1wb3J0IEFwaSBmcm9tIFwiLi4vdXRpbHMvQXBpLmpzXCI7XG5cbmltcG9ydCB7IGVuYWJsZVZhbGlkYXRpb24sIHJlc2V0VmFsaWRhdGlvbiB9IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCB7IHZhbGlkYXRpb25Db25maWcgfSBmcm9tIFwiLi4vc2NyaXB0cy9jb25zdGFudHMuanNcIjtcblxuY29uc3QgYXBpID0gbmV3IEFwaSh7XG4gIGJhc2VVcmw6IFwiaHR0cHM6Ly9hcm91bmQtYXBpLmVuLnRyaXBsZXRlbi1zZXJ2aWNlcy5jb20vdjFcIixcbiAgaGVhZGVyczoge1xuICAgIGF1dGhvcml6YXRpb246IFwiMjRmOTMzZGUtNzU4MS00YjRjLWFkZTQtYzFhMzU5YzgyYjFiXCIsXG4gIH0sXG59KTtcblxubGV0IGN1cnJlbnRVc2VySWQgPSBudWxsO1xuXG5mdW5jdGlvbiBvcGVuTW9kYWwobW9kYWwpIHtcbiAgaWYgKCFtb2RhbCkgcmV0dXJuO1xuICBtb2RhbC5jbGFzc0xpc3QuYWRkKFwibW9kYWxfaXMtb3BlbmVkXCIpO1xuICBkb2N1bWVudC5hZGRFdmVudExpc3RlbmVyKFwia2V5ZG93blwiLCBoYW5kbGVFc2NDbG9zZSk7XG59XG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIGlmICghbW9kYWwpIHJldHVybjtcbiAgbW9kYWwuY2xhc3NMaXN0LnJlbW92ZShcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQucmVtb3ZlRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjQ2xvc2UpO1xufVxuZnVuY3Rpb24gaGFuZGxlRXNjQ2xvc2UoZXZ0KSB7XG4gIGlmIChldnQua2V5ID09PSBcIkVzY2FwZVwiKSB7XG4gICAgY29uc3Qgb3BlbmVkTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsLm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgICBpZiAob3BlbmVkTW9kYWwpIGNsb3NlTW9kYWwob3BlbmVkTW9kYWwpO1xuICB9XG59XG5mdW5jdGlvbiBzZXRTYXZpbmcoYnRuLCBzYXZpbmcpIHtcbiAgaWYgKCFidG4pIHJldHVybjtcbiAgYnRuLmRhdGFzZXQuZGVmYXVsdFRleHQgPz89IGJ0bi50ZXh0Q29udGVudDtcbiAgYnRuLnRleHRDb250ZW50ID0gc2F2aW5nID8gXCJTYXZpbmfigKZcIiA6IGJ0bi5kYXRhc2V0LmRlZmF1bHRUZXh0O1xuICBidG4uZGlzYWJsZWQgPSAhIXNhdmluZztcbn1cblxuY29uc3QgcHJldmlld01vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNwcmV2aWV3LW1vZGFsXCIpO1xuY29uc3QgbW9kYWxJbWFnZSA9IHByZXZpZXdNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fcHJldmlldy1pbWFnZVwiKTtcbmNvbnN0IG1vZGFsQ2FwdGlvbiA9IHByZXZpZXdNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2FwdGlvblwiKTtcbmNvbnN0IG1vZGFsQ2xvc2VCdG4gPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiLm1vZGFsX19jbG9zZS1idG5fdHlwZV9wcmV2aWV3XCJcbik7XG5cbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPVxuICBlZGl0UHJvZmlsZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBlZGl0UHJvZmlsZUZvcm0gPSBlZGl0UHJvZmlsZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVOYW1lSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLW5hbWUtaW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXG4gIFwiI3Byb2ZpbGUtZGVzY3JpcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IHByb2ZpbGVOYW1lRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25hbWVcIik7XG5jb25zdCBwcm9maWxlRGVzY3JpcHRpb25FbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZGVzY3JpcHRpb25cIik7XG5cbmNvbnN0IG5ld1Bvc3RCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX25ldy1wb3N0LWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjbmV3LXBvc3QtbW9kYWxcIik7XG5jb25zdCBuZXdQb3N0Q2xvc2VCdG4gPSBuZXdQb3N0TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IG5ld1Bvc3RGb3JtID0gbmV3UG9zdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgbmV3UG9zdExpbmsgPSBuZXdQb3N0TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIjY2FyZC1pbWFnZS1pbnB1dFwiKTtcbmNvbnN0IG5ld1Bvc3RDYXB0aW9uID0gbmV3UG9zdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtY2FwdGlvbi1pbnB1dFwiKTtcblxuY29uc3QgYXZhdGFySW1nRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhclwiKTtcbmNvbnN0IGF2YXRhckVkaXRCdG4gPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2F2YXRhci1lZGl0LWJ0blwiKTtcbmNvbnN0IGF2YXRhck1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGF2YXRhckZvcm0gPSBhdmF0YXJNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGF2YXRhcklucHV0ID0gYXZhdGFyTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIjYXZhdGFyLWxpbmstaW5wdXRcIik7XG5jb25zdCBhdmF0YXJDbG9zZUJ0biA9IGF2YXRhck1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5cbmNvbnN0IGNvbmZpcm1Nb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjY29uZmlybS1tb2RhbFwiKTtcbmNvbnN0IGNvbmZpcm1Gb3JtID0gY29uZmlybU1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgY29uZmlybUNsb3NlQnRuID0gY29uZmlybU1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgPy5jb250ZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZFwiKTtcbmNvbnN0IGNhcmRzTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZHNfX2xpc3RcIik7XG5cbmZ1bmN0aW9uIHJlbmRlckNhcmQoY2FyZERhdGEpIHtcbiAgY29uc3QgY2FyZEVsZW1lbnQgPSBjYXJkVGVtcGxhdGUuY2xvbmVOb2RlKHRydWUpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRUaXRsZUVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgY2FyZExpa2VCdG5FbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGNhcmREZWxldGVCdG5FbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcbiAgY29uc3QgY2FyZExpa2VDb3VudEVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19saWtlLWNvdW50XCIpO1xuXG4gIGNhcmRJbWFnZUVsLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gIGNhcmRJbWFnZUVsLmFsdCA9IGNhcmREYXRhLm5hbWU7XG4gIGNhcmRUaXRsZUVsLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcblxuICBjb25zdCBsaWtlcyA9IEFycmF5LmlzQXJyYXkoY2FyZERhdGEubGlrZXMpID8gY2FyZERhdGEubGlrZXMgOiBbXTtcbiAgY29uc3QgaXNMaWtlZCA9IGxpa2VzLnNvbWUoKHUpID0+IHUuX2lkID09PSBjdXJyZW50VXNlcklkKTtcbiAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIsIGlzTGlrZWQpO1xuICBpZiAoY2FyZExpa2VDb3VudEVsKSBjYXJkTGlrZUNvdW50RWwudGV4dENvbnRlbnQgPSBTdHJpbmcobGlrZXMubGVuZ3RoKTtcblxuICBpZiAoIWNhcmREYXRhLm93bmVyIHx8IGNhcmREYXRhLm93bmVyLl9pZCAhPT0gY3VycmVudFVzZXJJZCkge1xuICAgIGNhcmREZWxldGVCdG5FbD8ucmVtb3ZlKCk7XG4gIH1cblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGlmICghcHJldmlld01vZGFsKSByZXR1cm47XG4gICAgbW9kYWxDYXB0aW9uLnRleHRDb250ZW50ID0gY2FyZERhdGEubmFtZTtcbiAgICBtb2RhbEltYWdlLnNyYyA9IGNhcmREYXRhLmxpbms7XG4gICAgbW9kYWxJbWFnZS5hbHQgPSBjYXJkRGF0YS5uYW1lO1xuICAgIG9wZW5Nb2RhbChwcmV2aWV3TW9kYWwpO1xuICB9KTtcblxuICBjYXJkTGlrZUJ0bkVsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gICAgY29uc3QgYWN0aXZlID0gY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gICAgY2FyZExpa2VCdG5FbC5kaXNhYmxlZCA9IHRydWU7XG4gICAgY29uc3QgcmVxID0gYWN0aXZlXG4gICAgICA/IGFwaS51bmxpa2VDYXJkKGNhcmREYXRhLl9pZClcbiAgICAgIDogYXBpLmxpa2VDYXJkKGNhcmREYXRhLl9pZCk7XG4gICAgcmVxXG4gICAgICAudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICBjb25zdCBub3dMaWtlZCA9IHVwZGF0ZWQubGlrZXMuc29tZSgodSkgPT4gdS5faWQgPT09IGN1cnJlbnRVc2VySWQpO1xuICAgICAgICBjYXJkTGlrZUJ0bkVsLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIiwgbm93TGlrZWQpO1xuICAgICAgICBpZiAoY2FyZExpa2VDb3VudEVsKVxuICAgICAgICAgIGNhcmRMaWtlQ291bnRFbC50ZXh0Q29udGVudCA9IFN0cmluZyh1cGRhdGVkLmxpa2VzLmxlbmd0aCk7XG4gICAgICB9KVxuICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgICAuZmluYWxseSgoKSA9PiAoY2FyZExpa2VCdG5FbC5kaXNhYmxlZCA9IGZhbHNlKSk7XG4gIH0pO1xuXG4gIGNhcmREZWxldGVCdG5FbD8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBjb25zdCBkb0RlbGV0ZSA9ICgpID0+IHtcbiAgICAgIGNvbnN0IHN1Ym1pdEJ0biA9IGNvbmZpcm1Nb2RhbD8ucXVlcnlTZWxlY3RvcignYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKTtcbiAgICAgIHNldFNhdmluZyhzdWJtaXRCdG4sIHRydWUpO1xuICAgICAgYXBpXG4gICAgICAgIC5kZWxldGVDYXJkKGNhcmREYXRhLl9pZClcbiAgICAgICAgLnRoZW4oKCkgPT4ge1xuICAgICAgICAgIGNhcmRFbGVtZW50LnJlbW92ZSgpO1xuICAgICAgICAgIGlmIChjb25maXJtTW9kYWwpIGNsb3NlTW9kYWwoY29uZmlybU1vZGFsKTtcbiAgICAgICAgfSlcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgICAgIC5maW5hbGx5KCgpID0+IHNldFNhdmluZyhzdWJtaXRCdG4sIGZhbHNlKSk7XG4gICAgfTtcblxuICAgIGlmIChjb25maXJtTW9kYWwgJiYgY29uZmlybUZvcm0pIHtcbiAgICAgIG9wZW5Nb2RhbChjb25maXJtTW9kYWwpO1xuICAgICAgY29uc3QgaGFuZGxlciA9IChlKSA9PiB7XG4gICAgICAgIGUucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uZmlybUZvcm0ucmVtb3ZlRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVyKTtcbiAgICAgICAgZG9EZWxldGUoKTtcbiAgICAgIH07XG4gICAgICBjb25maXJtRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZXIsIHsgb25jZTogdHJ1ZSB9KTtcbiAgICB9IGVsc2Uge1xuICAgICAgaWYgKHdpbmRvdy5jb25maXJtKFwiRGVsZXRlIHRoaXMgY2FyZD9cIikpIGRvRGVsZXRlKCk7XG4gICAgfVxuICB9KTtcblxuICByZXR1cm4gY2FyZEVsZW1lbnQ7XG59XG5cbm1vZGFsQ2xvc2VCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCkpO1xucHJldmlld01vZGFsPy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gIGlmIChlLnRhcmdldCA9PT0gcHJldmlld01vZGFsKSBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuZWRpdFByb2ZpbGVCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgaWYgKGVkaXRQcm9maWxlTmFtZUlucHV0KVxuICAgIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcbiAgaWYgKGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dClcbiAgICBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbiAgaWYgKGVkaXRQcm9maWxlRm9ybSkgcmVzZXRWYWxpZGF0aW9uKGVkaXRQcm9maWxlRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XG59KTtcbmVkaXRQcm9maWxlQ2xvc2VCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PlxuICBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpXG4pO1xuZWRpdFByb2ZpbGVNb2RhbD8uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICBpZiAoZS50YXJnZXQgPT09IGVkaXRQcm9maWxlTW9kYWwpIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxubmV3UG9zdEJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpKTtcbm5ld1Bvc3RDbG9zZUJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKSk7XG5uZXdQb3N0TW9kYWw/LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09PSBuZXdQb3N0TW9kYWwpIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5hdmF0YXJFZGl0QnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBpZiAoIWF2YXRhck1vZGFsKSByZXR1cm47XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG4gIGlmIChhdmF0YXJGb3JtKSByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XG59KTtcbmF2YXRhckNsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChhdmF0YXJNb2RhbCkpO1xuYXZhdGFyTW9kYWw/LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09PSBhdmF0YXJNb2RhbCkgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuY29uZmlybUNsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChjb25maXJtTW9kYWwpKTtcbmNvbmZpcm1Nb2RhbD8uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICBpZiAoZS50YXJnZXQgPT09IGNvbmZpcm1Nb2RhbCkgY2xvc2VNb2RhbChjb25maXJtTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlRm9ybT8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZXZ0KSA9PiB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBidG4gPVxuICAgIGV2dC5zdWJtaXR0ZXIgfHwgZWRpdFByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gIHNldFNhdmluZyhidG4sIHRydWUpO1xuICBjb25zdCBuYW1lID0gZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUudHJpbSgpO1xuICBjb25zdCBhYm91dCA9IGVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgYXBpXG4gICAgLnVwZGF0ZVVzZXJJbmZvKHsgbmFtZSwgYWJvdXQgfSlcbiAgICAudGhlbigodXNlcikgPT4ge1xuICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICAgIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiBzZXRTYXZpbmcoYnRuLCBmYWxzZSkpO1xufSk7XG5cbm5ld1Bvc3RGb3JtPy5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ0biA9XG4gICAgZXZ0LnN1Ym1pdHRlciB8fCBuZXdQb3N0Rm9ybS5xdWVyeVNlbGVjdG9yKCdidXR0b25bdHlwZT1cInN1Ym1pdFwiXScpO1xuICBzZXRTYXZpbmcoYnRuLCB0cnVlKTtcblxuICBjb25zdCBuYW1lID0gbmV3UG9zdENhcHRpb24udmFsdWUudHJpbSgpO1xuICBjb25zdCBsaW5rID0gbmV3UG9zdExpbmsudmFsdWUudHJpbSgpO1xuXG4gIGFwaVxuICAgIC5hZGRDYXJkKHsgbmFtZSwgbGluayB9KVxuICAgIC50aGVuKChzZXJ2ZXJDYXJkKSA9PiB7XG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChyZW5kZXJDYXJkKHNlcnZlckNhcmQpKTtcbiAgICAgIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbiAgICAgIG5ld1Bvc3RGb3JtLnJlc2V0KCk7XG4gICAgICByZXNldFZhbGlkYXRpb24obmV3UG9zdEZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4gc2V0U2F2aW5nKGJ0biwgZmFsc2UpKTtcbn0pO1xuXG5hdmF0YXJGb3JtPy5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIChldnQpID0+IHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ0biA9XG4gICAgZXZ0LnN1Ym1pdHRlciB8fCBhdmF0YXJGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gIHNldFNhdmluZyhidG4sIHRydWUpO1xuICBjb25zdCBhdmF0YXIgPSBhdmF0YXJJbnB1dC52YWx1ZS50cmltKCk7XG5cbiAgYXBpXG4gICAgLnVwZGF0ZUF2YXRhcihhdmF0YXIpXG4gICAgLnRoZW4oKHVzZXIpID0+IHtcbiAgICAgIGlmIChhdmF0YXJJbWdFbCkgYXZhdGFySW1nRWwuc3JjID0gdXNlci5hdmF0YXI7XG4gICAgICBjbG9zZU1vZGFsKGF2YXRhck1vZGFsKTtcbiAgICAgIGF2YXRhckZvcm0ucmVzZXQoKTtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbihhdmF0YXJGb3JtLCB2YWxpZGF0aW9uQ29uZmlnKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHNldFNhdmluZyhidG4sIGZhbHNlKSk7XG59KTtcblxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxuICAudGhlbigoW3VzZXIsIGNhcmRzXSkgPT4ge1xuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VyLl9pZDtcbiAgICBpZiAocHJvZmlsZU5hbWVFbCkgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICBpZiAocHJvZmlsZURlc2NyaXB0aW9uRWwpIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICBpZiAoYXZhdGFySW1nRWwpIGF2YXRhckltZ0VsLnNyYyA9IHVzZXIuYXZhdGFyO1xuXG4gICAgY2FyZHNMaXN0LmlubmVySFRNTCA9IFwiXCI7XG4gICAgY2FyZHMuZm9yRWFjaCgoYykgPT4gY2FyZHNMaXN0LmFwcGVuZChyZW5kZXJDYXJkKGMpKSk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmwucmVwbGFjZSgvXFwvJC8sIFwiXCIpO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG5cbiAgX2hhbmRsZVJlc3BvbnNlKHJlcykge1xuICAgIGlmIChyZXMub2spIHJldHVybiByZXMuanNvbigpO1xuICAgIHJldHVybiByZXMudGV4dCgpLnRoZW4oKHQpID0+IHtcbiAgICAgIGNvbnN0IG1zZyA9IHQgJiYgdC50cmltKCkubGVuZ3RoID8gdCA6IGBIVFRQICR7cmVzLnN0YXR1c31gO1xuICAgICAgdGhyb3cgbmV3IEVycm9yKG1zZyk7XG4gICAgfSk7XG4gIH1cblxuICBfcmVxdWVzdChwYXRoLCB7IG1ldGhvZCA9IFwiR0VUXCIsIGhlYWRlcnMsIGJvZHkgfSA9IHt9KSB7XG4gICAgY29uc3QgZmluYWxIZWFkZXJzID0ge1xuICAgICAgLi4udGhpcy5faGVhZGVycyxcbiAgICAgIC4uLihib2R5ID8geyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9IDoge30pLFxuICAgICAgLi4uKGhlYWRlcnMgfHwge30pLFxuICAgIH07XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9JHtwYXRofWAsIHtcbiAgICAgIG1ldGhvZCxcbiAgICAgIGhlYWRlcnM6IGZpbmFsSGVhZGVycyxcbiAgICAgIGJvZHksXG4gICAgfSkudGhlbigocikgPT4gdGhpcy5faGFuZGxlUmVzcG9uc2UocikpO1xuICB9XG5cbiAgZ2V0VXNlckluZm8oKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC91c2Vycy9tZWApO1xuICB9XG5cbiAgdXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC91c2Vycy9tZWAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBhYm91dCB9KSxcbiAgICB9KTtcbiAgfVxuXG4gIHVwZGF0ZUF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXIgfSksXG4gICAgfSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkc2ApO1xuICB9XG5cbiAgYWRkQ2FyZCh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHNgLCB7XG4gICAgICBtZXRob2Q6IFwiUE9TVFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBuYW1lLCBsaW5rIH0pLFxuICAgIH0pO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtpZH1gLCB7IG1ldGhvZDogXCJERUxFVEVcIiB9KTtcbiAgfVxuXG4gIGxpa2VDYXJkKGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy9saWtlcy8ke2lkfWAsIHsgbWV0aG9kOiBcIlBVVFwiIH0pO1xuICB9XG5cbiAgdW5saWtlQ2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvbGlrZXMvJHtpZH1gLCB7IG1ldGhvZDogXCJERUxFVEVcIiB9KTtcbiAgfVxuXG4gIGNoYW5nZUxpa2VDYXJkU3RhdHVzKGlkLCBsaWtlKSB7XG4gICAgcmV0dXJuIGxpa2UgPyB0aGlzLmxpa2VDYXJkKGlkKSA6IHRoaXMudW5saWtlQ2FyZChpZCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJyZXNldEJ1dHRvblN0YXRlIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJmb3JFYWNoIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsInJlcGxhY2UiLCJfaGVhZGVycyIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsInRleHQiLCJ0aGVuIiwidCIsIm1zZyIsInRyaW0iLCJsZW5ndGgiLCJzdGF0dXMiLCJFcnJvciIsIl9yZXF1ZXN0IiwicGF0aCIsIm1ldGhvZCIsImJvZHkiLCJmaW5hbEhlYWRlcnMiLCJmZXRjaCIsInIiLCJnZXRVc2VySW5mbyIsInVwZGF0ZVVzZXJJbmZvIiwibmFtZSIsImFib3V0IiwiSlNPTiIsInN0cmluZ2lmeSIsInVwZGF0ZUF2YXRhciIsImF2YXRhciIsImdldEluaXRpYWxDYXJkcyIsImFkZENhcmQiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsImNoYW5nZUxpa2VDYXJkU3RhdHVzIiwibGlrZSIsImF1dGhvcml6YXRpb24iLCJjdXJyZW50VXNlcklkIiwib3Blbk1vZGFsIiwibW9kYWwiLCJkb2N1bWVudCIsImFkZEV2ZW50TGlzdGVuZXIiLCJoYW5kbGVFc2NDbG9zZSIsImNsb3NlTW9kYWwiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZ0Iiwia2V5Iiwib3BlbmVkTW9kYWwiLCJzZXRTYXZpbmciLCJidG4iLCJzYXZpbmciLCJkYXRhc2V0IiwiZGVmYXVsdFRleHQiLCJwcmV2aWV3TW9kYWwiLCJtb2RhbEltYWdlIiwibW9kYWxDYXB0aW9uIiwibW9kYWxDbG9zZUJ0biIsImVkaXRQcm9maWxlQnRuIiwiZWRpdFByb2ZpbGVNb2RhbCIsImVkaXRQcm9maWxlQ2xvc2VCdG4iLCJlZGl0UHJvZmlsZUZvcm0iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXRQcm9maWxlRGVzY3JpcHRpb25JbnB1dCIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsIm5ld1Bvc3RCdG4iLCJuZXdQb3N0TW9kYWwiLCJuZXdQb3N0Q2xvc2VCdG4iLCJuZXdQb3N0Rm9ybSIsIm5ld1Bvc3RMaW5rIiwibmV3UG9zdENhcHRpb24iLCJhdmF0YXJJbWdFbCIsImF2YXRhckVkaXRCdG4iLCJhdmF0YXJNb2RhbCIsImF2YXRhckZvcm0iLCJhdmF0YXJJbnB1dCIsImF2YXRhckNsb3NlQnRuIiwiY29uZmlybU1vZGFsIiwiY29uZmlybUZvcm0iLCJjb25maXJtQ2xvc2VCdG4iLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiY2FyZHNMaXN0IiwicmVuZGVyQ2FyZCIsImNhcmREYXRhIiwiY2FyZEVsZW1lbnQiLCJjbG9uZU5vZGUiLCJjYXJkSW1hZ2VFbCIsImNhcmRUaXRsZUVsIiwiY2FyZExpa2VCdG5FbCIsImNhcmREZWxldGVCdG5FbCIsImNhcmRMaWtlQ291bnRFbCIsInNyYyIsImFsdCIsImxpa2VzIiwiaXNBcnJheSIsImlzTGlrZWQiLCJ1IiwiX2lkIiwidG9nZ2xlIiwiU3RyaW5nIiwib3duZXIiLCJhY3RpdmUiLCJjb250YWlucyIsInVwZGF0ZWQiLCJub3dMaWtlZCIsImNhdGNoIiwiY29uc29sZSIsImVycm9yIiwiZmluYWxseSIsImRvRGVsZXRlIiwic3VibWl0QnRuIiwiaGFuZGxlciIsImUiLCJwcmV2ZW50RGVmYXVsdCIsIm9uY2UiLCJ3aW5kb3ciLCJjb25maXJtIiwidGFyZ2V0IiwidmFsdWUiLCJzdWJtaXR0ZXIiLCJ1c2VyIiwic2VydmVyQ2FyZCIsInByZXBlbmQiLCJyZXNldCIsIlByb21pc2UiLCJhbGwiLCJjYXJkcyIsImlubmVySFRNTCIsImMiLCJhcHBlbmQiLCJtZXNzYWdlIiwic2hvd0lucHV0RXJyb3IiLCJ2YWxpZGF0aW9uTWVzc2FnZSIsImNoZWNrSW5wdXRWYWxpZGl0eSIsInNldEV2ZW50TGlzdGVuZXJzIl0sInNvdXJjZVJvb3QiOiIifQ==