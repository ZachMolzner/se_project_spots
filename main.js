!function(){"use strict";function e(e,t,r){const n=e.querySelector(`#${t.id}-error`);t.classList.remove(r.inputErrorClass),n.textContent="",n.classList.remove(r.errorClass)}function t(e,t,r){!function(e){return e.some(e=>!e.validity.valid)}(e)?(t.classList.remove(r.inactiveButtonClass),t.disabled=!1):(t.classList.add(r.inactiveButtonClass),t.disabled=!0)}function r(r,n,{resetButtonState:o=!0}={}){const a=Array.from(r.querySelectorAll(n.inputSelector));a.forEach(t=>e(r,t,n)),o&&t(a,r.querySelector(n.submitButtonSelector),n)}const n={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__input-error_visible"},o=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e.replace(/\/$/,""),this._headers=t}_handleResponse(e){return e.ok?e.json():e.text().then(t=>{throw new Error(t||`HTTP ${e.status}`)})}_request(e,{method:t="GET",headers:r,body:n}={}){return fetch(`${this._baseUrl}${e}`,{method:t,headers:{...this._headers,...n?{"Content-Type":"application/json"}:{},...r},body:n}).then(this._handleResponse)}getUserInfo(){return this._request("/users/me")}updateUserInfo(e){return this._request("/users/me",{method:"PATCH",body:JSON.stringify(e)})}updateAvatar(e){return this._request("/users/me/avatar",{method:"PATCH",body:JSON.stringify({avatar:e})})}getInitialCards(){return this._request("/cards")}addCard({name:e,link:t}){return this._request("/cards",{method:"POST",body:JSON.stringify({name:e,link:t})})}deleteCard(e){return this._request(`/cards/${e}`,{method:"DELETE"})}likeCard(e){return this._request(`/cards/${e}/likes`,{method:"PUT"})}unlikeCard(e){return this._request(`/cards/${e}/likes`,{method:"DELETE"})}getAppData(){return Promise.all([this.getUserInfo(),this.getInitialCards()])}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"800f8c77-4aa6-4b88-989e-2391faf166e2"}});let a=null;function s(e){e&&(e.classList.add("modal_is-opened"),document.addEventListener("keydown",l))}function i(e){e&&(e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",l))}function l(e){if("Escape"!==e.key)return;const t=document.querySelector(".modal.modal_is-opened");t&&i(t)}function c(e,t,r="Saving…"){e&&(e.dataset.defaultText??=e.textContent,e.textContent=t?r:e.dataset.defaultText,e.disabled=!!t)}const d=document.querySelector("#preview-modal"),u=d?.querySelector(".modal__preview-image"),m=d?.querySelector(".modal__caption"),_=d?.querySelector(".modal__close-btn_type_preview"),y=document.querySelector(".profile__edit-btn"),p=document.querySelector("#edit-profile-modal"),v=p?.querySelector(".modal__close-btn"),f=p?.querySelector(".modal__form"),S=p?.querySelector("#profile-name-input"),h=p?.querySelector("#profile-description-input"),q=document.querySelector(".profile__name"),b=document.querySelector(".profile__description"),L=document.querySelector(".profile__new-post-btn"),k=document.querySelector("#new-post-modal"),C=k?.querySelector(".modal__close-btn"),E=k?.querySelector(".modal__form"),g=k?.querySelector("#card-image-input"),w=k?.querySelector("#card-caption-input"),x=document.querySelector(".profile__avatar"),A=document.querySelector(".profile__avatar-edit-btn"),T=document.querySelector("#edit-avatar-modal"),U=T?.querySelector(".modal__form"),B=T?.querySelector("#avatar-link-input"),D=T?.querySelector(".modal__close-btn"),$=document.querySelector("#confirm-modal"),I=$?.querySelector(".modal__form"),P=$?.querySelector(".modal__close-btn"),H=document.querySelector("#card-template")?.content.querySelector(".card"),N=document.querySelector(".cards__list");function O(e){const t=H.cloneNode(!0),r=t.querySelector(".card__image"),n=t.querySelector(".card__title"),l=t.querySelector(".card__like-btn"),_=t.querySelector(".card__delete-btn"),y=t.querySelector(".card__like-count");r.src=e.link,r.alt=e.name,n.textContent=e.name;const p=Array.isArray(e.likes)?e.likes:null,v=p&&p.some(e=>e._id===a)||Boolean(e.isLiked);l.classList.toggle("card__like-btn_active",v),y&&(p?(y.textContent=String(p.length),y.style.display=""):y.style.display="none");const f=e.owner&&(e.owner._id||e.owner);return f&&f===a||_?.remove(),r.addEventListener("click",()=>{d&&(m.textContent=e.name,u.src=e.link,u.alt=e.name,s(d))}),l.addEventListener("click",()=>{const t=l.classList.contains("card__like-btn_active");l.disabled=!0,("function"==typeof o.changeLikeCardStatus?o.changeLikeCardStatus(e._id,!t):t?o.unlikeCard(e._id):o.likeCard(e._id)).then(e=>{const t=Array.isArray(e.likes)?e.likes:null,r=t&&t.some(e=>e._id===a)||Boolean(e.isLiked);l.classList.toggle("card__like-btn_active",r),y&&(t?(y.textContent=String(t.length),y.style.display=""):y.style.display="none")}).catch(console.error).finally(()=>{l.disabled=!1})}),_?.addEventListener("click",()=>{if($&&I){s($);const r=r=>{r.preventDefault();const n=I.querySelector('button[type="submit"]');c(n,!0,"Deleting…"),o.deleteCard(e._id).then(()=>{t.remove(),i($)}).catch(console.error).finally(()=>c(n,!1))};I.addEventListener("submit",r,{once:!0})}else window.confirm("Delete this card?")&&o.deleteCard(e._id).then(()=>t.remove()).catch(console.error)}),t}var J;_?.addEventListener("click",()=>i(d)),d?.addEventListener("mousedown",e=>{e.target===d&&i(d)}),y?.addEventListener("click",()=>{s(p),S&&(S.value=q.textContent),h&&(h.value=b.textContent),f&&r(f,n)}),v?.addEventListener("click",()=>i(p)),p?.addEventListener("mousedown",e=>{e.target===p&&i(p)}),f?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||f.querySelector('button[type="submit"]');c(t,!0);const r=S.value.trim(),n=h.value.trim();o.updateUserInfo({name:r,about:n}).then(e=>{q.textContent=e.name,b.textContent=e.about,i(p)}).catch(console.error).finally(()=>c(t,!1))}),L?.addEventListener("click",()=>s(k)),C?.addEventListener("click",()=>i(k)),k?.addEventListener("mousedown",e=>{e.target===k&&i(k)}),E?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||E.querySelector('button[type="submit"]');c(t,!0);const a=w.value.trim(),s=g.value.trim();o.addCard({name:a,link:s}).then(e=>{N.prepend(O(e)),i(k),E.reset(),r(E,n)}).catch(console.error).finally(()=>c(t,!1))}),A?.addEventListener("click",()=>{s(T),U&&r(U,n)}),D?.addEventListener("click",()=>i(T)),T?.addEventListener("mousedown",e=>{e.target===T&&i(T)}),U?.addEventListener("submit",e=>{e.preventDefault();const t=e.submitter||U.querySelector('button[type="submit"]');c(t,!0);const a=B.value.trim();o.updateAvatar(a).then(e=>{x&&(x.src=e.avatar),i(T),U.reset(),r(U,n)}).catch(console.error).finally(()=>c(t,!1))}),P?.addEventListener("click",()=>i($)),$?.addEventListener("mousedown",e=>{e.target===$&&i($)}),Promise.all([o.getUserInfo(),o.getInitialCards()]).then(([e,t])=>{a=e._id,q&&(q.textContent=e.name),b&&(b.textContent=e.about),x&&(x.src=e.avatar),N.innerHTML="",t.forEach(e=>N.append(O(e)))}).catch(console.error),J=n,Array.from(document.querySelectorAll(J.formSelector)).forEach(r=>function(r,n){const o=Array.from(r.querySelectorAll(n.inputSelector)),a=r.querySelector(n.submitButtonSelector);t(o,a,n),o.forEach(s=>{s.addEventListener("input",()=>{!function(t,r,n){r.validity.valid?e(t,r,n):function(e,t,r,n){const o=e.querySelector(`#${t.id}-error`);t.classList.add(n.inputErrorClass),o.textContent=r,o.classList.add(n.errorClass)}(t,r,r.validationMessage,n)}(r,s,n),t(o,a,n)})})}(r,J))}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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YyxTQUFTQyxNQUdwQmpCLEVBQWVDLEVBQVFDLEVBQVNDLEdBbEJwQyxTQUF3QkYsRUFBUUMsRUFBUzJLLEVBQVMxSyxHQUNoRCxNQUFNQyxFQUFVSCxFQUFPSSxjQUFjLElBQUlILEVBQVFJLFlBQ2pESixFQUFRSyxVQUFVYyxJQUFJbEIsRUFBT00saUJBQzdCTCxFQUFRTSxZQUFjbUssRUFDdEJ6SyxFQUFRRyxVQUFVYyxJQUFJbEIsRUFBT1EsV0FDL0IsQ0FXSW1LLENBQWU3SyxFQUFRQyxFQUFTQSxFQUFRNkssa0JBQW1CNUssRUFJL0QsQ0F3Qk02SyxDQUFtQi9LLEVBQVFDLEVBQVNDLEdBQ3BDUyxFQUFrQkMsRUFBV0MsRUFBVVgsTUFHN0MsQ0FJK0I4SyxDQUFrQmhMLEVBQVFFLEciLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvdmFsaWRhdGlvbi5qcyIsIndlYnBhY2s6Ly9zZV9wcm9qZWN0X3Nwb3RzLy4vc3JjL3NjcmlwdHMvY29uc3RhbnRzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZnVuY3Rpb24gc2hvd0lucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBtZXNzYWdlLCBjb25maWcpIHtcbiAgY29uc3QgZXJyb3JFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBpbnB1dEVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmlucHV0RXJyb3JDbGFzcyk7XG4gIGVycm9yRWwudGV4dENvbnRlbnQgPSBtZXNzYWdlO1xuICBlcnJvckVsLmNsYXNzTGlzdC5hZGQoY29uZmlnLmVycm9yQ2xhc3MpO1xufVxuXG5mdW5jdGlvbiBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykge1xuICBjb25zdCBlcnJvckVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGlucHV0RWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5wdXRFcnJvckNsYXNzKTtcbiAgZXJyb3JFbC50ZXh0Q29udGVudCA9IFwiXCI7XG4gIGVycm9yRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuZXJyb3JDbGFzcyk7XG59XG5cbmZ1bmN0aW9uIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZykge1xuICBpZiAoIWlucHV0RWwudmFsaWRpdHkudmFsaWQpIHtcbiAgICBzaG93SW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGlucHV0RWwudmFsaWRhdGlvbk1lc3NhZ2UsIGNvbmZpZyk7XG4gIH0gZWxzZSB7XG4gICAgaGlkZUlucHV0RXJyb3IoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGhhc0ludmFsaWRJbnB1dChpbnB1dExpc3QpIHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dEVsKSA9PiAhaW5wdXRFbC52YWxpZGl0eS52YWxpZCk7XG59XG5cbmZ1bmN0aW9uIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZykge1xuICBpZiAoaGFzSW52YWxpZElucHV0KGlucHV0TGlzdCkpIHtcbiAgICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IHRydWU7XG4gIH0gZWxzZSB7XG4gICAgYnV0dG9uRWwuY2xhc3NMaXN0LnJlbW92ZShjb25maWcuaW5hY3RpdmVCdXR0b25DbGFzcyk7XG4gICAgYnV0dG9uRWwuZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuXG5mdW5jdGlvbiBzZXRFdmVudExpc3RlbmVycyhmb3JtRWwsIGNvbmZpZykge1xuICBjb25zdCBpbnB1dExpc3QgPSBBcnJheS5mcm9tKGZvcm1FbC5xdWVyeVNlbGVjdG9yQWxsKGNvbmZpZy5pbnB1dFNlbGVjdG9yKSk7XG4gIGNvbnN0IGJ1dHRvbkVsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoY29uZmlnLnN1Ym1pdEJ1dHRvblNlbGVjdG9yKTtcblxuICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuXG4gIGlucHV0TGlzdC5mb3JFYWNoKChpbnB1dEVsKSA9PiB7XG4gICAgaW5wdXRFbC5hZGRFdmVudExpc3RlbmVyKFwiaW5wdXRcIiwgKCkgPT4ge1xuICAgICAgY2hlY2tJbnB1dFZhbGlkaXR5KGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKTtcbiAgICAgIHRvZ2dsZUJ1dHRvblN0YXRlKGlucHV0TGlzdCwgYnV0dG9uRWwsIGNvbmZpZyk7XG4gICAgfSk7XG4gIH0pO1xufVxuXG5leHBvcnQgZnVuY3Rpb24gZW5hYmxlVmFsaWRhdGlvbihjb25maWcpIHtcbiAgY29uc3QgZm9ybUxpc3QgPSBBcnJheS5mcm9tKGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3RvcikpO1xuICBmb3JtTGlzdC5mb3JFYWNoKChmb3JtRWwpID0+IHNldEV2ZW50TGlzdGVuZXJzKGZvcm1FbCwgY29uZmlnKSk7XG59XG5cbmV4cG9ydCBmdW5jdGlvbiByZXNldFZhbGlkYXRpb24oXG4gIGZvcm1FbCxcbiAgY29uZmlnLFxuICB7IHJlc2V0QnV0dG9uU3RhdGUgPSB0cnVlIH0gPSB7fVxuKSB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgaW5wdXRMaXN0LmZvckVhY2goKGlucHV0RWwpID0+IGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSk7XG5cbiAgaWYgKHJlc2V0QnV0dG9uU3RhdGUpIHtcbiAgICBjb25zdCBidXR0b25FbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGNvbmZpZy5zdWJtaXRCdXR0b25TZWxlY3Rvcik7XG4gICAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcbiAgfVxufVxuIiwiZXhwb3J0IGNvbnN0IHZhbGlkYXRpb25Db25maWcgPSB7XG4gIGZvcm1TZWxlY3RvcjogXCIubW9kYWxfX2Zvcm1cIixcbiAgaW5wdXRTZWxlY3RvcjogXCIubW9kYWxfX2lucHV0XCIsXG4gIHN1Ym1pdEJ1dHRvblNlbGVjdG9yOiBcIi5tb2RhbF9fc3VibWl0LWJ0blwiLFxuICBpbmFjdGl2ZUJ1dHRvbkNsYXNzOiBcIm1vZGFsX19zdWJtaXQtYnRuX2Rpc2FibGVkXCIsXG4gIGlucHV0RXJyb3JDbGFzczogXCJtb2RhbF9faW5wdXRfdHlwZV9lcnJvclwiLFxuICBlcnJvckNsYXNzOiBcIm1vZGFsX19pbnB1dC1lcnJvcl92aXNpYmxlXCIsXG59O1xuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuXG5pbXBvcnQgeyBlbmFibGVWYWxpZGF0aW9uLCByZXNldFZhbGlkYXRpb24gfSBmcm9tIFwiLi4vc2NyaXB0cy92YWxpZGF0aW9uLmpzXCI7XG5pbXBvcnQgeyB2YWxpZGF0aW9uQ29uZmlnIH0gZnJvbSBcIi4uL3NjcmlwdHMvY29uc3RhbnRzLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjgwMGY4Yzc3LTRhYTYtNGI4OC05ODllLTIzOTFmYWYxNjZlMlwiLFxuICB9LFxufSk7XG5cbmxldCBjdXJyZW50VXNlcklkID0gbnVsbDtcblxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIGlmICghbW9kYWwpIHJldHVybjtcbiAgbW9kYWwuY2xhc3NMaXN0LmFkZChcIm1vZGFsX2lzLW9wZW5lZFwiKTtcbiAgZG9jdW1lbnQuYWRkRXZlbnRMaXN0ZW5lcihcImtleWRvd25cIiwgaGFuZGxlRXNjQ2xvc2UpO1xufVxuZnVuY3Rpb24gY2xvc2VNb2RhbChtb2RhbCkge1xuICBpZiAoIW1vZGFsKSByZXR1cm47XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY0Nsb3NlKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUVzY0Nsb3NlKGUpIHtcbiAgaWYgKGUua2V5ICE9PSBcIkVzY2FwZVwiKSByZXR1cm47XG4gIGNvbnN0IG9wZW5lZCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWwubW9kYWxfaXMtb3BlbmVkXCIpO1xuICBpZiAob3BlbmVkKSBjbG9zZU1vZGFsKG9wZW5lZCk7XG59XG5mdW5jdGlvbiBzZXRTYXZpbmcoYnRuLCBzYXZpbmcsIHRleHQgPSBcIlNhdmluZ+KAplwiKSB7XG4gIGlmICghYnRuKSByZXR1cm47XG4gIGJ0bi5kYXRhc2V0LmRlZmF1bHRUZXh0ID8/PSBidG4udGV4dENvbnRlbnQ7XG4gIGJ0bi50ZXh0Q29udGVudCA9IHNhdmluZyA/IHRleHQgOiBidG4uZGF0YXNldC5kZWZhdWx0VGV4dDtcbiAgYnRuLmRpc2FibGVkID0gISFzYXZpbmc7XG59XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IG1vZGFsSW1hZ2UgPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3ByZXZpZXctaW1hZ2VcIik7XG5jb25zdCBtb2RhbENhcHRpb24gPSBwcmV2aWV3TW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2NhcHRpb25cIik7XG5jb25zdCBtb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsPy5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnRuX3R5cGVfcHJldmlld1wiXG4pO1xuXG5jb25zdCBlZGl0UHJvZmlsZUJ0biA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIucHJvZmlsZV9fZWRpdC1idG5cIik7XG5jb25zdCBlZGl0UHJvZmlsZU1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNlZGl0LXByb2ZpbGUtbW9kYWxcIik7XG5jb25zdCBlZGl0UHJvZmlsZUNsb3NlQnRuID1cbiAgZWRpdFByb2ZpbGVNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVGb3JtID0gZWRpdFByb2ZpbGVNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTmFtZUlucHV0ID0gZWRpdFByb2ZpbGVNb2RhbD8ucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcbik7XG5jb25zdCBlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQgPSBlZGl0UHJvZmlsZU1vZGFsPy5xdWVyeVNlbGVjdG9yKFxuICBcIiNwcm9maWxlLWRlc2NyaXB0aW9uLWlucHV0XCJcbik7XG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uZXctcG9zdC1idG5cIik7XG5jb25zdCBuZXdQb3N0TW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI25ldy1wb3N0LW1vZGFsXCIpO1xuY29uc3QgbmV3UG9zdENsb3NlQnRuID0gbmV3UG9zdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBuZXdQb3N0Rm9ybSA9IG5ld1Bvc3RNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IG5ld1Bvc3RMaW5rID0gbmV3UG9zdE1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0Q2FwdGlvbiA9IG5ld1Bvc3RNb2RhbD8ucXVlcnlTZWxlY3RvcihcIiNjYXJkLWNhcHRpb24taW5wdXRcIik7XG5cbmNvbnN0IGF2YXRhckltZ0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5jb25zdCBhdmF0YXJFZGl0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItZWRpdC1idG5cIik7XG5jb25zdCBhdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJGb3JtID0gYXZhdGFyTW9kYWw/LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBhdmF0YXJJbnB1dCA9IGF2YXRhck1vZGFsPy5xdWVyeVNlbGVjdG9yKFwiI2F2YXRhci1saW5rLWlucHV0XCIpO1xuY29uc3QgYXZhdGFyQ2xvc2VCdG4gPSBhdmF0YXJNb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuXG5jb25zdCBjb25maXJtTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2NvbmZpcm0tbW9kYWxcIik7XG5jb25zdCBjb25maXJtRm9ybSA9IGNvbmZpcm1Nb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGNvbmZpcm1DbG9zZUJ0biA9IGNvbmZpcm1Nb2RhbD8ucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fY2xvc2UtYnRuXCIpO1xuXG5jb25zdCBjYXJkVGVtcGxhdGUgPSBkb2N1bWVudFxuICAucXVlcnlTZWxlY3RvcihcIiNjYXJkLXRlbXBsYXRlXCIpXG4gID8uY29udGVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRcIik7XG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuXG5mdW5jdGlvbiByZW5kZXJDYXJkKGNhcmREYXRhKSB7XG4gIGNvbnN0IGVsID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgaW1nRWwgPSBlbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2ltYWdlXCIpO1xuICBjb25zdCB0aXRsZUVsID0gZWwucXVlcnlTZWxlY3RvcihcIi5jYXJkX190aXRsZVwiKTtcbiAgY29uc3QgbGlrZUJ0biA9IGVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fbGlrZS1idG5cIik7XG4gIGNvbnN0IGRlbEJ0biA9IGVsLnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9fZGVsZXRlLWJ0blwiKTtcbiAgY29uc3QgbGlrZUNvdW50RWwgPSBlbC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtY291bnRcIik7XG5cbiAgaW1nRWwuc3JjID0gY2FyZERhdGEubGluaztcbiAgaW1nRWwuYWx0ID0gY2FyZERhdGEubmFtZTtcbiAgdGl0bGVFbC50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG5cbiAgY29uc3QgbGlrZXNBcnIgPSBBcnJheS5pc0FycmF5KGNhcmREYXRhLmxpa2VzKSA/IGNhcmREYXRhLmxpa2VzIDogbnVsbDtcbiAgY29uc3QgaW5pdGlhbGx5TGlrZWQgPVxuICAgIChsaWtlc0FyciAmJiBsaWtlc0Fyci5zb21lKCh1KSA9PiB1Ll9pZCA9PT0gY3VycmVudFVzZXJJZCkpIHx8XG4gICAgQm9vbGVhbihjYXJkRGF0YS5pc0xpa2VkKTtcbiAgbGlrZUJ0bi5jbGFzc0xpc3QudG9nZ2xlKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIsIGluaXRpYWxseUxpa2VkKTtcblxuICBpZiAobGlrZUNvdW50RWwpIHtcbiAgICBpZiAobGlrZXNBcnIpIHtcbiAgICAgIGxpa2VDb3VudEVsLnRleHRDb250ZW50ID0gU3RyaW5nKGxpa2VzQXJyLmxlbmd0aCk7XG4gICAgICBsaWtlQ291bnRFbC5zdHlsZS5kaXNwbGF5ID0gXCJcIjtcbiAgICB9IGVsc2Uge1xuICAgICAgbGlrZUNvdW50RWwuc3R5bGUuZGlzcGxheSA9IFwibm9uZVwiO1xuICAgIH1cbiAgfVxuXG4gIGNvbnN0IG93bmVySWQgPSBjYXJkRGF0YS5vd25lciAmJiAoY2FyZERhdGEub3duZXIuX2lkIHx8IGNhcmREYXRhLm93bmVyKTtcbiAgaWYgKCFvd25lcklkIHx8IG93bmVySWQgIT09IGN1cnJlbnRVc2VySWQpIGRlbEJ0bj8ucmVtb3ZlKCk7XG5cbiAgaW1nRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoIXByZXZpZXdNb2RhbCkgcmV0dXJuO1xuICAgIG1vZGFsQ2FwdGlvbi50ZXh0Q29udGVudCA9IGNhcmREYXRhLm5hbWU7XG4gICAgbW9kYWxJbWFnZS5zcmMgPSBjYXJkRGF0YS5saW5rO1xuICAgIG1vZGFsSW1hZ2UuYWx0ID0gY2FyZERhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgbGlrZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIGNvbnN0IGFjdGl2ZSA9IGxpa2VCdG4uY2xhc3NMaXN0LmNvbnRhaW5zKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICAgIGxpa2VCdG4uZGlzYWJsZWQgPSB0cnVlO1xuXG4gICAgY29uc3QgcmVxID1cbiAgICAgIHR5cGVvZiBhcGkuY2hhbmdlTGlrZUNhcmRTdGF0dXMgPT09IFwiZnVuY3Rpb25cIlxuICAgICAgICA/IGFwaS5jaGFuZ2VMaWtlQ2FyZFN0YXR1cyhjYXJkRGF0YS5faWQsICFhY3RpdmUpXG4gICAgICAgIDogYWN0aXZlXG4gICAgICAgID8gYXBpLnVubGlrZUNhcmQoY2FyZERhdGEuX2lkKVxuICAgICAgICA6IGFwaS5saWtlQ2FyZChjYXJkRGF0YS5faWQpO1xuXG4gICAgcmVxXG4gICAgICAudGhlbigodXBkYXRlZCkgPT4ge1xuICAgICAgICBjb25zdCB1TGlrZXMgPSBBcnJheS5pc0FycmF5KHVwZGF0ZWQubGlrZXMpID8gdXBkYXRlZC5saWtlcyA6IG51bGw7XG4gICAgICAgIGNvbnN0IG5vd0xpa2VkID1cbiAgICAgICAgICAodUxpa2VzICYmIHVMaWtlcy5zb21lKCh1KSA9PiB1Ll9pZCA9PT0gY3VycmVudFVzZXJJZCkpIHx8XG4gICAgICAgICAgQm9vbGVhbih1cGRhdGVkLmlzTGlrZWQpO1xuICAgICAgICBsaWtlQnRuLmNsYXNzTGlzdC50b2dnbGUoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIiwgbm93TGlrZWQpO1xuXG4gICAgICAgIGlmIChsaWtlQ291bnRFbCkge1xuICAgICAgICAgIGlmICh1TGlrZXMpIHtcbiAgICAgICAgICAgIGxpa2VDb3VudEVsLnRleHRDb250ZW50ID0gU3RyaW5nKHVMaWtlcy5sZW5ndGgpO1xuICAgICAgICAgICAgbGlrZUNvdW50RWwuc3R5bGUuZGlzcGxheSA9IFwiXCI7XG4gICAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICAgIGxpa2VDb3VudEVsLnN0eWxlLmRpc3BsYXkgPSBcIm5vbmVcIjtcbiAgICAgICAgICB9XG4gICAgICAgIH1cbiAgICAgIH0pXG4gICAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgICAgbGlrZUJ0bi5kaXNhYmxlZCA9IGZhbHNlO1xuICAgICAgfSk7XG4gIH0pO1xuXG4gIGRlbEJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBpZiAoY29uZmlybU1vZGFsICYmIGNvbmZpcm1Gb3JtKSB7XG4gICAgICBvcGVuTW9kYWwoY29uZmlybU1vZGFsKTtcbiAgICAgIGNvbnN0IG9uU3VibWl0ID0gKGV2dCkgPT4ge1xuICAgICAgICBldnQucHJldmVudERlZmF1bHQoKTtcbiAgICAgICAgY29uc3QgYnRuID0gY29uZmlybUZvcm0ucXVlcnlTZWxlY3RvcignYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKTtcbiAgICAgICAgc2V0U2F2aW5nKGJ0biwgdHJ1ZSwgXCJEZWxldGluZ+KAplwiKTtcbiAgICAgICAgYXBpXG4gICAgICAgICAgLmRlbGV0ZUNhcmQoY2FyZERhdGEuX2lkKVxuICAgICAgICAgIC50aGVuKCgpID0+IHtcbiAgICAgICAgICAgIGVsLnJlbW92ZSgpO1xuICAgICAgICAgICAgY2xvc2VNb2RhbChjb25maXJtTW9kYWwpO1xuICAgICAgICAgIH0pXG4gICAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgICAgICAgLmZpbmFsbHkoKCkgPT4gc2V0U2F2aW5nKGJ0biwgZmFsc2UpKTtcbiAgICAgIH07XG4gICAgICBjb25maXJtRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIG9uU3VibWl0LCB7IG9uY2U6IHRydWUgfSk7XG4gICAgfSBlbHNlIGlmICh3aW5kb3cuY29uZmlybShcIkRlbGV0ZSB0aGlzIGNhcmQ/XCIpKSB7XG4gICAgICBhcGlcbiAgICAgICAgLmRlbGV0ZUNhcmQoY2FyZERhdGEuX2lkKVxuICAgICAgICAudGhlbigoKSA9PiBlbC5yZW1vdmUoKSlcbiAgICAgICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpO1xuICAgIH1cbiAgfSk7XG5cbiAgcmV0dXJuIGVsO1xufVxuXG5tb2RhbENsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpKTtcbnByZXZpZXdNb2RhbD8uYWRkRXZlbnRMaXN0ZW5lcihcIm1vdXNlZG93blwiLCAoZSkgPT4ge1xuICBpZiAoZS50YXJnZXQgPT09IHByZXZpZXdNb2RhbCkgY2xvc2VNb2RhbChwcmV2aWV3TW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gIGlmIChlZGl0UHJvZmlsZU5hbWVJbnB1dClcbiAgICBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZSA9IHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQ7XG4gIGlmIChlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQpXG4gICAgZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlID0gcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQ7XG4gIGlmIChlZGl0UHJvZmlsZUZvcm0pIHJlc2V0VmFsaWRhdGlvbihlZGl0UHJvZmlsZUZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xufSk7XG5lZGl0UHJvZmlsZUNsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT5cbiAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKVxuKTtcbmVkaXRQcm9maWxlTW9kYWw/LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09PSBlZGl0UHJvZmlsZU1vZGFsKSBjbG9zZU1vZGFsKGVkaXRQcm9maWxlTW9kYWwpO1xufSk7XG5cbmVkaXRQcm9maWxlRm9ybT8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ0biA9XG4gICAgZS5zdWJtaXR0ZXIgfHwgZWRpdFByb2ZpbGVGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gIHNldFNhdmluZyhidG4sIHRydWUpO1xuXG4gIGNvbnN0IG5hbWUgPSBlZGl0UHJvZmlsZU5hbWVJbnB1dC52YWx1ZS50cmltKCk7XG4gIGNvbnN0IGFib3V0ID0gZWRpdFByb2ZpbGVEZXNjcmlwdGlvbklucHV0LnZhbHVlLnRyaW0oKTtcblxuICBhcGlcbiAgICAudXBkYXRlVXNlckluZm8oeyBuYW1lLCBhYm91dCB9KVxuICAgIC50aGVuKCh1c2VyKSA9PiB7XG4gICAgICBwcm9maWxlTmFtZUVsLnRleHRDb250ZW50ID0gdXNlci5uYW1lO1xuICAgICAgcHJvZmlsZURlc2NyaXB0aW9uRWwudGV4dENvbnRlbnQgPSB1c2VyLmFib3V0O1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHNldFNhdmluZyhidG4sIGZhbHNlKSk7XG59KTtcblxubmV3UG9zdEJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IG9wZW5Nb2RhbChuZXdQb3N0TW9kYWwpKTtcbm5ld1Bvc3RDbG9zZUJ0bj8uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKSk7XG5uZXdQb3N0TW9kYWw/LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09PSBuZXdQb3N0TW9kYWwpIGNsb3NlTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Rm9ybT8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ0biA9IGUuc3VibWl0dGVyIHx8IG5ld1Bvc3RGb3JtLnF1ZXJ5U2VsZWN0b3IoJ2J1dHRvblt0eXBlPVwic3VibWl0XCJdJyk7XG4gIHNldFNhdmluZyhidG4sIHRydWUpO1xuXG4gIGNvbnN0IG5hbWUgPSBuZXdQb3N0Q2FwdGlvbi52YWx1ZS50cmltKCk7XG4gIGNvbnN0IGxpbmsgPSBuZXdQb3N0TGluay52YWx1ZS50cmltKCk7XG5cbiAgYXBpXG4gICAgLmFkZENhcmQoeyBuYW1lLCBsaW5rIH0pXG4gICAgLnRoZW4oKHNlcnZlckNhcmQpID0+IHtcbiAgICAgIGNhcmRzTGlzdC5wcmVwZW5kKHJlbmRlckNhcmQoc2VydmVyQ2FyZCkpO1xuICAgICAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xuICAgICAgbmV3UG9zdEZvcm0ucmVzZXQoKTtcbiAgICAgIHJlc2V0VmFsaWRhdGlvbihuZXdQb3N0Rm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiBzZXRTYXZpbmcoYnRuLCBmYWxzZSkpO1xufSk7XG5cbmF2YXRhckVkaXRCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiB7XG4gIG9wZW5Nb2RhbChhdmF0YXJNb2RhbCk7XG4gIGlmIChhdmF0YXJGb3JtKSByZXNldFZhbGlkYXRpb24oYXZhdGFyRm9ybSwgdmFsaWRhdGlvbkNvbmZpZyk7XG59KTtcbmF2YXRhckNsb3NlQnRuPy5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4gY2xvc2VNb2RhbChhdmF0YXJNb2RhbCkpO1xuYXZhdGFyTW9kYWw/LmFkZEV2ZW50TGlzdGVuZXIoXCJtb3VzZWRvd25cIiwgKGUpID0+IHtcbiAgaWYgKGUudGFyZ2V0ID09PSBhdmF0YXJNb2RhbCkgY2xvc2VNb2RhbChhdmF0YXJNb2RhbCk7XG59KTtcblxuYXZhdGFyRm9ybT8uYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCAoZSkgPT4ge1xuICBlLnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IGJ0biA9IGUuc3VibWl0dGVyIHx8IGF2YXRhckZvcm0ucXVlcnlTZWxlY3RvcignYnV0dG9uW3R5cGU9XCJzdWJtaXRcIl0nKTtcbiAgc2V0U2F2aW5nKGJ0biwgdHJ1ZSk7XG5cbiAgY29uc3QgYXZhdGFyID0gYXZhdGFySW5wdXQudmFsdWUudHJpbSgpO1xuICBhcGlcbiAgICAudXBkYXRlQXZhdGFyKGF2YXRhcilcbiAgICAudGhlbigodXNlcikgPT4ge1xuICAgICAgaWYgKGF2YXRhckltZ0VsKSBhdmF0YXJJbWdFbC5zcmMgPSB1c2VyLmF2YXRhcjtcbiAgICAgIGNsb3NlTW9kYWwoYXZhdGFyTW9kYWwpO1xuICAgICAgYXZhdGFyRm9ybS5yZXNldCgpO1xuICAgICAgcmVzZXRWYWxpZGF0aW9uKGF2YXRhckZvcm0sIHZhbGlkYXRpb25Db25maWcpO1xuICAgIH0pXG4gICAgLmNhdGNoKGNvbnNvbGUuZXJyb3IpXG4gICAgLmZpbmFsbHkoKCkgPT4gc2V0U2F2aW5nKGJ0biwgZmFsc2UpKTtcbn0pO1xuXG5jb25maXJtQ2xvc2VCdG4/LmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoKSA9PiBjbG9zZU1vZGFsKGNvbmZpcm1Nb2RhbCkpO1xuY29uZmlybU1vZGFsPy5hZGRFdmVudExpc3RlbmVyKFwibW91c2Vkb3duXCIsIChlKSA9PiB7XG4gIGlmIChlLnRhcmdldCA9PT0gY29uZmlybU1vZGFsKSBjbG9zZU1vZGFsKGNvbmZpcm1Nb2RhbCk7XG59KTtcblxuUHJvbWlzZS5hbGwoW2FwaS5nZXRVc2VySW5mbygpLCBhcGkuZ2V0SW5pdGlhbENhcmRzKCldKVxuICAudGhlbigoW3VzZXIsIGNhcmRzXSkgPT4ge1xuICAgIGN1cnJlbnRVc2VySWQgPSB1c2VyLl9pZDtcbiAgICBpZiAocHJvZmlsZU5hbWVFbCkgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IHVzZXIubmFtZTtcbiAgICBpZiAocHJvZmlsZURlc2NyaXB0aW9uRWwpIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlci5hYm91dDtcbiAgICBpZiAoYXZhdGFySW1nRWwpIGF2YXRhckltZ0VsLnNyYyA9IHVzZXIuYXZhdGFyO1xuXG4gICAgY2FyZHNMaXN0LmlubmVySFRNTCA9IFwiXCI7XG4gICAgY2FyZHMuZm9yRWFjaCgoYykgPT4gY2FyZHNMaXN0LmFwcGVuZChyZW5kZXJDYXJkKGMpKSk7XG4gIH0pXG4gIC5jYXRjaChjb25zb2xlLmVycm9yKTtcblxuZW5hYmxlVmFsaWRhdGlvbih2YWxpZGF0aW9uQ29uZmlnKTtcbiIsImNsYXNzIEFwaSB7XG4gIGNvbnN0cnVjdG9yKHsgYmFzZVVybCwgaGVhZGVycyB9KSB7XG4gICAgdGhpcy5fYmFzZVVybCA9IGJhc2VVcmwucmVwbGFjZSgvXFwvJC8sIFwiXCIpO1xuICAgIHRoaXMuX2hlYWRlcnMgPSBoZWFkZXJzO1xuICB9XG4gIF9oYW5kbGVSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSByZXR1cm4gcmVzLmpzb24oKTtcbiAgICByZXR1cm4gcmVzLnRleHQoKS50aGVuKCh0KSA9PiB7XG4gICAgICB0aHJvdyBuZXcgRXJyb3IodCB8fCBgSFRUUCAke3Jlcy5zdGF0dXN9YCk7XG4gICAgfSk7XG4gIH1cbiAgX3JlcXVlc3QocGF0aCwgeyBtZXRob2QgPSBcIkdFVFwiLCBoZWFkZXJzLCBib2R5IH0gPSB7fSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfSR7cGF0aH1gLCB7XG4gICAgICBtZXRob2QsXG4gICAgICBoZWFkZXJzOiB7XG4gICAgICAgIC4uLnRoaXMuX2hlYWRlcnMsXG4gICAgICAgIC4uLihib2R5ID8geyBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIiB9IDoge30pLFxuICAgICAgICAuLi5oZWFkZXJzLFxuICAgICAgfSxcbiAgICAgIGJvZHksXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVSZXNwb25zZSk7XG4gIH1cblxuICBnZXRVc2VySW5mbygpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL3VzZXJzL21lYCk7XG4gIH1cbiAgdXBkYXRlVXNlckluZm8oZGF0YSkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvdXNlcnMvbWVgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KGRhdGEpLFxuICAgIH0pO1xuICB9XG4gIHVwZGF0ZUF2YXRhcihhdmF0YXIpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL3VzZXJzL21lL2F2YXRhcmAsIHtcbiAgICAgIG1ldGhvZDogXCJQQVRDSFwiLFxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoeyBhdmF0YXIgfSksXG4gICAgfSk7XG4gIH1cblxuICBnZXRJbml0aWFsQ2FyZHMoKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkc2ApO1xuICB9XG4gIGFkZENhcmQoeyBuYW1lLCBsaW5rIH0pIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzYCwge1xuICAgICAgbWV0aG9kOiBcIlBPU1RcIixcbiAgICAgIGJvZHk6IEpTT04uc3RyaW5naWZ5KHsgbmFtZSwgbGluayB9KSxcbiAgICB9KTtcbiAgfVxuICBkZWxldGVDYXJkKGlkKSB7XG4gICAgcmV0dXJuIHRoaXMuX3JlcXVlc3QoYC9jYXJkcy8ke2lkfWAsIHsgbWV0aG9kOiBcIkRFTEVURVwiIH0pO1xuICB9XG5cbiAgbGlrZUNhcmQoaWQpIHtcbiAgICByZXR1cm4gdGhpcy5fcmVxdWVzdChgL2NhcmRzLyR7aWR9L2xpa2VzYCwgeyBtZXRob2Q6IFwiUFVUXCIgfSk7XG4gIH1cbiAgdW5saWtlQ2FyZChpZCkge1xuICAgIHJldHVybiB0aGlzLl9yZXF1ZXN0KGAvY2FyZHMvJHtpZH0vbGlrZXNgLCB7IG1ldGhvZDogXCJERUxFVEVcIiB9KTtcbiAgfVxuXG4gIGdldEFwcERhdGEoKSB7XG4gICAgcmV0dXJuIFByb21pc2UuYWxsKFt0aGlzLmdldFVzZXJJbmZvKCksIHRoaXMuZ2V0SW5pdGlhbENhcmRzKCldKTtcbiAgfVxufVxuZXhwb3J0IGRlZmF1bHQgQXBpO1xuIl0sIm5hbWVzIjpbImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsImVycm9yRWwiLCJxdWVyeVNlbGVjdG9yIiwiaWQiLCJjbGFzc0xpc3QiLCJyZW1vdmUiLCJpbnB1dEVycm9yQ2xhc3MiLCJ0ZXh0Q29udGVudCIsImVycm9yQ2xhc3MiLCJ0b2dnbGVCdXR0b25TdGF0ZSIsImlucHV0TGlzdCIsImJ1dHRvbkVsIiwic29tZSIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiZGlzYWJsZWQiLCJhZGQiLCJyZXNldFZhbGlkYXRpb24iLCJyZXNldEJ1dHRvblN0YXRlIiwiQXJyYXkiLCJmcm9tIiwicXVlcnlTZWxlY3RvckFsbCIsImlucHV0U2VsZWN0b3IiLCJmb3JFYWNoIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJ2YWxpZGF0aW9uQ29uZmlnIiwiZm9ybVNlbGVjdG9yIiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsInJlcGxhY2UiLCJfaGVhZGVycyIsIl9oYW5kbGVSZXNwb25zZSIsInJlcyIsIm9rIiwianNvbiIsInRleHQiLCJ0aGVuIiwidCIsIkVycm9yIiwic3RhdHVzIiwiX3JlcXVlc3QiLCJwYXRoIiwibWV0aG9kIiwiYm9keSIsImZldGNoIiwiZ2V0VXNlckluZm8iLCJ1cGRhdGVVc2VySW5mbyIsImRhdGEiLCJKU09OIiwic3RyaW5naWZ5IiwidXBkYXRlQXZhdGFyIiwiYXZhdGFyIiwiZ2V0SW5pdGlhbENhcmRzIiwiYWRkQ2FyZCIsIm5hbWUiLCJsaW5rIiwiZGVsZXRlQ2FyZCIsImxpa2VDYXJkIiwidW5saWtlQ2FyZCIsImdldEFwcERhdGEiLCJQcm9taXNlIiwiYWxsIiwiYXV0aG9yaXphdGlvbiIsImN1cnJlbnRVc2VySWQiLCJvcGVuTW9kYWwiLCJtb2RhbCIsImRvY3VtZW50IiwiYWRkRXZlbnRMaXN0ZW5lciIsImhhbmRsZUVzY0Nsb3NlIiwiY2xvc2VNb2RhbCIsInJlbW92ZUV2ZW50TGlzdGVuZXIiLCJlIiwia2V5Iiwib3BlbmVkIiwic2V0U2F2aW5nIiwiYnRuIiwic2F2aW5nIiwiZGF0YXNldCIsImRlZmF1bHRUZXh0IiwicHJldmlld01vZGFsIiwibW9kYWxJbWFnZSIsIm1vZGFsQ2FwdGlvbiIsIm1vZGFsQ2xvc2VCdG4iLCJlZGl0UHJvZmlsZUJ0biIsImVkaXRQcm9maWxlTW9kYWwiLCJlZGl0UHJvZmlsZUNsb3NlQnRuIiwiZWRpdFByb2ZpbGVGb3JtIiwiZWRpdFByb2ZpbGVOYW1lSW5wdXQiLCJlZGl0UHJvZmlsZURlc2NyaXB0aW9uSW5wdXQiLCJwcm9maWxlTmFtZUVsIiwicHJvZmlsZURlc2NyaXB0aW9uRWwiLCJuZXdQb3N0QnRuIiwibmV3UG9zdE1vZGFsIiwibmV3UG9zdENsb3NlQnRuIiwibmV3UG9zdEZvcm0iLCJuZXdQb3N0TGluayIsIm5ld1Bvc3RDYXB0aW9uIiwiYXZhdGFySW1nRWwiLCJhdmF0YXJFZGl0QnRuIiwiYXZhdGFyTW9kYWwiLCJhdmF0YXJGb3JtIiwiYXZhdGFySW5wdXQiLCJhdmF0YXJDbG9zZUJ0biIsImNvbmZpcm1Nb2RhbCIsImNvbmZpcm1Gb3JtIiwiY29uZmlybUNsb3NlQnRuIiwiY2FyZFRlbXBsYXRlIiwiY29udGVudCIsImNhcmRzTGlzdCIsInJlbmRlckNhcmQiLCJjYXJkRGF0YSIsImVsIiwiY2xvbmVOb2RlIiwiaW1nRWwiLCJ0aXRsZUVsIiwibGlrZUJ0biIsImRlbEJ0biIsImxpa2VDb3VudEVsIiwic3JjIiwiYWx0IiwibGlrZXNBcnIiLCJpc0FycmF5IiwibGlrZXMiLCJpbml0aWFsbHlMaWtlZCIsInUiLCJfaWQiLCJCb29sZWFuIiwiaXNMaWtlZCIsInRvZ2dsZSIsIlN0cmluZyIsImxlbmd0aCIsInN0eWxlIiwiZGlzcGxheSIsIm93bmVySWQiLCJvd25lciIsImFjdGl2ZSIsImNvbnRhaW5zIiwiY2hhbmdlTGlrZUNhcmRTdGF0dXMiLCJ1cGRhdGVkIiwidUxpa2VzIiwibm93TGlrZWQiLCJjYXRjaCIsImNvbnNvbGUiLCJlcnJvciIsImZpbmFsbHkiLCJvblN1Ym1pdCIsImV2dCIsInByZXZlbnREZWZhdWx0Iiwib25jZSIsIndpbmRvdyIsImNvbmZpcm0iLCJ0YXJnZXQiLCJ2YWx1ZSIsInN1Ym1pdHRlciIsInRyaW0iLCJhYm91dCIsInVzZXIiLCJzZXJ2ZXJDYXJkIiwicHJlcGVuZCIsInJlc2V0IiwiY2FyZHMiLCJpbm5lckhUTUwiLCJjIiwiYXBwZW5kIiwibWVzc2FnZSIsInNob3dJbnB1dEVycm9yIiwidmFsaWRhdGlvbk1lc3NhZ2UiLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzZXRFdmVudExpc3RlbmVycyJdLCJzb3VyY2VSb290IjoiIn0=